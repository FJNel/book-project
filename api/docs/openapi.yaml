openapi: 3.1.0
info:
  title: The Book Project API
  version: 1.0.0
  description: |
    Source-of-truth OpenAPI specification for the Book Project REST API. All endpoints return
    a consistent JSON envelope and support either Bearer access tokens or API keys unless
    explicitly marked public.
  license:
    name: The Book Project Source-Available Proprietary License
    url: https://bookproject.fjnel.co.za
servers:
  - url: https://api.fjnel.co.za
    description: Production server
  - url: http://127.0.0.1:4000
    description: Local development
security:
  - bearerAuth: []
  - apiKeyHeader: []
  - apiKeyAuthHeader: []
tags:
  - name: Meta
    description: Service metadata and health endpoints.
  - name: Auth
    description: Registration, login, tokens, and account security flows.
  - name: Users
    description: Authenticated user self-service actions.
  - name: BookTypes
    description: Manage book format/type taxonomy for a user.
  - name: Authors
    description: Author records and related maintenance.
  - name: Publishers
    description: Publisher records and related maintenance.
  - name: Series
    description: Series records and related maintenance.
  - name: BookSeriesLinks
    description: Linking books to series and ordering within a series.
  - name: Languages
    description: Language catalogue (admin-controlled).
  - name: Books
    description: Book records, filtering, and stats.
  - name: StorageLocations
    description: Storage locations/shelves for physical copies.
  - name: BookCopies
    description: Individual physical copies and acquisition metadata.
  - name: Tags
    description: Tag catalogue and book-tag links.
  - name: Search
    description: Cross-entity search endpoints.
  - name: ImportExport
    description: Import/export utilities.
  - name: Logs
    description: Audit and HTTP logs.
  - name: Timeline
    description: Time-based aggregations for books and acquisitions.
  - name: Admin
    description: Admin-only endpoints and elevated user management.
  - name: Stats
    description: Statistics and aggregates across entities.
paths:
  /:
    get:
      tags: [Meta]
      summary: API base
      operationId: getApiBase
      description: Health check that confirms the API is reachable and returns the docs URL.
      security: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          timestamp:
                            type: string
                          apiDocumentationUrl:
                            type: string
              examples:
                success:
                  summary: Base check
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '1.08'
                    message: The API is working!
                    data:
                      timestamp: '2025-01-14T17:23:51Z'
                      apiDocumentationUrl: https://api.fjnel.co.za/docs/
                    errors: []
        '404':
          $ref: '#/components/responses/NotFound'
  /health:
    get:
      tags: [Meta]
      summary: Health check
      operationId: getHealth
      description: Simple uptime monitor endpoint.
      security: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          status:
                            type: string
                          timestamp:
                            type: string
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '1.12'
                    message: OK
                    data:
                      status: ok
                      timestamp: 2026-01-02T15:59:12.921Z
                    errors: []
        '429':
          $ref: '#/components/responses/RateLimit'
  /rate-limits:
    get:
      tags: [Meta]
      summary: Rate limit status
      operationId: getRateLimits
      description: Return current rate-limit window for the authenticated user.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter (shared bucket across authenticated endpoints)
      responses:
        '200':
          description: Current bucket
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RateLimitStatus'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '1.74'
                    message: Rate limit status retrieved successfully.
                    data:
                      limit: 60
                      remaining: 54
                      resetTime: 2026-01-02T16:05:00.000Z
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /auth/register:
    post:
      tags: [Auth]
      summary: Register
      operationId: registerUser
      description: Create a new user account. CAPTCHA required for the `register` action.
      security: []
      x-rateLimit:
        limit: 5
        window: 10m
        note: captchaLimiter action=register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              default:
                summary: Typical registration
                value:
                  captchaToken: "<captcha-token>"
                  fullName: Jane Doe
                  preferredName: Jane
                  email: jane@example.com
                  password: P@ssw0rd123!
      responses:
        '200':
          description: Registration accepted
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          disclaimer:
                            type: string
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '2.58'
                    message: If this email can be registered, you will receive an email with the next steps shortly.
                    data:
                      disclaimer: If you do not see an email within a few minutes, please check your spam folder or try again later.
                    errors: []
                captchaFailure:
                  summary: CAPTCHA failed
                  value:
                    status: error
                    httpCode: 400
                    responseTime: '5.44'
                    message: CAPTCHA verification failed
                    data: {}
                    errors:
                      - Please refresh the page and try again.
                      - Make sure that you provided a captchaToken in your request.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/resend-verification:
    post:
      tags: [Auth]
      summary: Resend verification email
      operationId: resendVerificationEmail
      description: Resend verification email for an unverified account. CAPTCHA action `resend_verification`.
      security: []
      x-rateLimit:
        limit: 1
        window: 5m
        note: captchaLimiter action=resend_verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [captchaToken, email]
              properties:
                captchaToken:
                  type: string
                email:
                  type: string
                  format: email
            examples:
              default:
                summary: Resend verification
                value:
                  captchaToken: "<captcha-token>"
                  email: jane@example.com
      responses:
        '200':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '3.12'
                    message: If you have registered an account with this email address and it is unverified, you will receive a verification email.
                    data:
                      disclaimer: If you did not receive an email when you should have, please check your spam folder or try again later.
                    errors: []
                captchaFailure:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: '5.27'
                    message: CAPTCHA verification failed
                    data: {}
                    errors:
                      - Please refresh the page and try again.
                      - Make sure that you provided a captchaToken in your request.
        '400':
          $ref: '#/components/responses/ValidationError'
  /auth/verify-email:
    post:
      tags: [Auth]
      summary: Verify email
      operationId: verifyEmail
      description: Verify user email using token sent during registration. CAPTCHA action `verify_email`.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [captchaToken, email, token]
              properties:
                captchaToken:
                  type: string
                email:
                  type: string
                  format: email
                token:
                  type: string
      responses:
        '200':
          description: Verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
  /auth/login:
    post:
      tags: [Auth]
      summary: Login with email/password
      operationId: loginWithEmail
      description: Authenticate and issue access/refresh tokens. CAPTCHA action `login`.
      security: []
      x-rateLimit:
        limit: 10
        window: 10m
        note: captchaLimiter action=login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              default:
                $ref: '#/components/examples/authLoginRequest'
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponseData'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '18.02'
                    message: Login successful.
                    data:
                      accessToken: <jwt>
                      refreshToken: <jwt>
                      user:
                        id: 12
                        email: jane@example.com
                        fullName: Jane Doe
                        preferredName: Jane
                        role: user
                        isVerified: true
                        passwordUpdated: 2024-07-11T10:22:33.000Z
                        lastLogin: 2025-01-17T09:20:11.000Z
                    errors: []
                invalidCredentials:
                  summary: Invalid credentials
                  value:
                    status: error
                    httpCode: 401
                    responseTime: '6.51'
                    message: Invalid email or password.
                    data: {}
                    errors:
                      - The provided email or password is incorrect
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthError'
  /auth/refresh-token:
    post:
      tags: [Auth]
      summary: Refresh access token
      operationId: refreshAccessToken
      description: Exchange a refresh token for a new access token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
            examples:
              default:
                summary: Refresh access token
                value:
                  refreshToken: "<refresh-token>"
      responses:
        '200':
          description: Refreshed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          accessToken:
                            type: string
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '7.81'
                    message: Access token refreshed.
                    data:
                      accessToken: "<new-jwt>"
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthError'
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      operationId: logout
      description: Revoke a single refresh token or all sessions for the authenticated user.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
            examples:
              singleSession:
                value:
                  refreshToken: "<refresh-token>"
                  allDevices: false
              allSessions:
                value:
                  allDevices: true
      responses:
        '200':
          description: Logged out
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                single:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "5.94"
                    message: Logged out successfully.
                    data:
                      scope: single
                      revokedSessions: 1
                    errors: []
                all:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "6.12"
                    message: Logged out successfully.
                    data:
                      scope: all
                      revokedSessions: 5
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /auth/request-password-reset:
    post:
      tags: [Auth]
      summary: Request password reset
      operationId: requestPasswordReset
      description: Send password reset email if account exists. CAPTCHA action `request_password_reset`.
      security: []
      x-rateLimit:
        limit: 1
        window: 5m
        note: captchaLimiter action=request_password_reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [captchaToken, email]
              properties:
                captchaToken:
                  type: string
                email:
                  type: string
                  format: email
            examples:
              default:
                summary: Request reset
                value:
                  captchaToken: "<captcha-token>"
                  email: jane@example.com
      responses:
        '200':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.84"
                    message: If you have registered an account with this email address, you will receive a password reset email.
                    data:
                      disclaimer: If you did not receive an email when you should have, please check your spam folder or try again later.
                    errors: []
                captchaFailure:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: "5.09"
                    message: CAPTCHA verification failed
                    data: {}
                    errors:
                      - Please refresh the page and try again.
                      - Make sure that you provided a captchaToken in your request.
        '400':
          $ref: '#/components/responses/ValidationError'
  /auth/reset-password:
    post:
      tags: [Auth]
      summary: Reset password
      operationId: resetPassword
      description: Reset password using emailed token. CAPTCHA action `reset_password`.
      security: []
      x-rateLimit:
        limit: 1
        window: 5m
        note: captchaLimiter action=reset_password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            examples:
              default:
                summary: Reset password
                value:
                  captchaToken: "<captcha-token>"
                  email: jane@example.com
                  token: "<reset-token>"
                  newPassword: NewP@ssw0rd123!
      responses:
        '200':
          description: Reset complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "9.42"
                    message: Password reset successfully. You can now log in.
                    data:
                      id: 12
                      email: jane@example.com
                      passwordUpdated: "2025-01-17T09:02:44.000Z"
                    errors: []
                invalidToken:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: "6.74"
                    message: Token expired or incorrect email address
                    data: {}
                    errors:
                      - The provided token is invalid, has expired, or the email address is incorrect.
                      - Please request a new password reset email.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/google:
    post:
      tags: [Auth]
      summary: Login with Google
      operationId: loginWithGoogle
      description: Sign up or sign in using a verified Google ID token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [idToken]
              properties:
                idToken:
                  type: string
            examples:
              default:
                summary: Google sign-in
                value:
                  idToken: "<google-id-token>"
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponseData'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "19.77"
                    message: Login successful.
                    data:
                      accessToken: "<jwt>"
                      refreshToken: "<jwt>"
                      user:
                        id: 12
                        email: jane@example.com
                        fullName: Jane Doe
                        preferredName: Jane
                        role: user
                        isVerified: true
                        passwordUpdated: null
                        lastLogin: "2025-01-17T09:20:11.000Z"
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthError'
  /users/me:
    get:
      tags: [Users]
      summary: Get my profile
      operationId: getMyProfile
      description: Retrieve authenticated user's profile and connected OAuth providers.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter
      responses:
        '200':
          description: Profile
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '4.73'
                    message: User profile retrieved successfully.
                    data:
                      id: 12
                      email: jane@example.com
                      fullName: Jane Doe
                      preferredName: Jane
                      role: user
                      isVerified: true
                      isDisabled: false
                      passwordUpdated: "2025-01-15T11:01:11.000Z"
                      lastLogin: "2025-01-17T09:20:11.000Z"
                      oauthProviders:
                        - google
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Users]
      summary: Update my profile
      operationId: updateMyProfile
      description: Update fullName and/or preferredName.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
            examples:
              updateNames:
                summary: Update preferred and full name
                value:
                  fullName: Jane Q. Doe
                  preferredName: Jan
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '6.41'
                    message: User profile updated successfully.
                    data:
                      id: 12
                      email: jane@example.com
                      fullName: Jane Q. Doe
                      preferredName: Jan
                      role: user
                      isVerified: true
                      isDisabled: false
                      passwordUpdated: "2025-01-15T11:01:11.000Z"
                      lastLogin: "2025-01-17T09:20:11.000Z"
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-17T08:44:02.000Z"
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Users]
      summary: Request account disable
      operationId: requestAccountDisable
      description: Initiate soft-delete and send confirmation email. Daily quota enforced plus email cost limiter.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter + emailCostLimiter
      responses:
        '200':
          description: Requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: '6.07'
                    message: Check your email to confirm this action.
                    data:
                      disclaimer: Your account will remain active until you confirm the disable request via the link we sent.
                    errors: []
        '404':
          $ref: '#/components/responses/NotFound'
  /users/me/verify-delete:
    post:
      tags: [Users]
      summary: Confirm account disable
      operationId: verifyAccountDisable
      description: Confirm disable request with email+token and CAPTCHA. Invalid token/email/captcha are returned as a generic invalid/expired token to avoid enumeration.
      security: []
      x-rateLimit:
        limit: 3
        window: 5m
        note: sensitiveActionLimiter + captchaLimiter action=verify_delete + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, email, captchaToken]
              properties:
                token:
                  type: string
                email:
                  type: string
                  format: email
                captchaToken:
                  type: string
            examples:
              verifyDelete:
                value:
                  token: "<verification-token>"
                  email: jane@example.com
                  captchaToken: "<captcha-token>"
      responses:
        '200':
          description: Disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "5.01"
                    message: Account disabled successfully.
                    data:
                      revokedSessions: 3
                    errors: []
        '400':
          description: Invalid or expired token, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalidToken:
                  $ref: '#/components/examples/invalidTokenExample'
                validationError:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: "2.22"
                    message: Validation Error
                    data: {}
                    errors:
                      - Email address is required.
        '422':
          $ref: '#/components/responses/ValidationError'
  /users/me/request-email-change:
    post:
      tags: [Users]
      summary: Request email change
      operationId: requestEmailChange
      description: Send verification link to change account email. Email cost limiter enforced.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter + emailCostLimiter
      x-dailyQuota:
        limit: 1
        window: day
        scope: account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [newEmail]
              properties:
                newEmail:
                  type: string
                  format: email
      responses:
        '200':
          description: Requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "4.90"
                    message: Check your email to confirm this action.
                    data:
                      disclaimer: If you did not receive an email when you should have, please check your spam folder or try again later.
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/DailyQuotaExceeded429'
  /users/me/verify-email-change:
    post:
      tags: [Users]
      summary: Confirm email change
      operationId: confirmEmailChange
      description: Confirm email change via token; CAPTCHA protected. Invalid token/email/password/captcha all return the same invalid token response to prevent enumeration.
      security: []
      x-rateLimit:
        limit: 3
        window: 5m
        note: sensitiveActionLimiter + captchaLimiter + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailChangeRequest'
            examples:
              confirm:
                summary: Confirm email change
                value:
                  token: "<email-change-token>"
                  oldEmail: jane@example.com
                  newEmail: jane.new@example.com
                  password: P@ssw0rd123!
                  captchaToken: "<captcha-token>"
      responses:
        '200':
          description: Email updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "5.10"
                    message: Your email address has been updated.
                    data:
                      disclaimer: Please log in with your new email address. You have been signed out on all devices.
                    errors: []
        '400':
          description: Invalid or expired token, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalidToken:
                  $ref: '#/components/examples/invalidTokenExample'
                validationError:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: "2.22"
                    message: Validation Error
                    data: {}
                    errors:
                      - Your current email address is required.
        '409':
          $ref: '#/components/responses/Conflict'
  /users/me/request-account-deletion:
    post:
      tags: [Users]
      summary: Request account deletion (POST)
      operationId: requestAccountDeletionPost
      description: Start delete flow (also available as DELETE). Email cost limiter enforced. Request body is not used.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter + emailCostLimiter
      x-dailyQuota:
        limit: 2
        window: day
        scope: account
        sharedAcrossMethods: [POST, DELETE]
      responses:
        '200':
          description: Requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "6.07"
                    message: Check your email to confirm this deletion request.
                    data:
                      disclaimer: Our support team will only be notified after you confirm via the email link.
                    errors: []
        '429':
          $ref: '#/components/responses/DailyQuotaExceeded429'
    delete:
      tags: [Users]
      summary: Request account deletion (DELETE)
      operationId: requestAccountDeletionDelete
      description: Start delete flow using DELETE verb. Email cost limiter enforced. Request body is not used.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter + emailCostLimiter
      x-dailyQuota:
        limit: 2
        window: day
        scope: account
        sharedAcrossMethods: [POST, DELETE]
      responses:
        '200':
          description: Requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "6.07"
                    message: Check your email to confirm this deletion request.
                    data:
                      disclaimer: Our support team will only be notified after you confirm via the email link.
                    errors: []
        '429':
          $ref: '#/components/responses/DailyQuotaExceeded429'
  /users/me/verify-account-deletion:
    post:
      tags: [Users]
      summary: Confirm account deletion
      operationId: verifyAccountDeletion
      description: Confirm permanent deletion using email + token + password + explicit confirmation + CAPTCHA. Invalid token/email/password/captcha return the same invalid token response to prevent enumeration.
      security: []
      x-rateLimit:
        limit: 3
        window: 5m
        note: sensitiveActionLimiter + captchaLimiter + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyAccountDeletionRequest'
            examples:
              confirmDeletion:
                summary: Confirm deletion
                value:
                  token: "<verification-token>"
                  email: jane@example.com
                  password: P@ssw0rd123!
                  confirm: true
                  captchaToken: "<captcha-token>"
      responses:
        '200':
          description: Confirmed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "5.01"
                    message: Your request has been forwarded to our support team.
                    data:
                      disclaimer: A member of our team will contact you on the confirmed email address to finalize the deletion.
                    errors: []
        '400':
          description: Invalid or expired token, or validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalidToken:
                  $ref: '#/components/examples/invalidTokenExample'
                validationError:
                  value:
                    status: error
                    httpCode: 400
                    responseTime: "2.22"
                    message: Validation Error
                    data: {}
                    errors:
                      - Email address is required.
  /users/me/sessions:
    get:
      tags: [Users]
      summary: List my sessions
      operationId: listMySessions
      description: List active refresh token fingerprints for the authenticated user.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Sessions
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          sessions:
                            type: array
                            items:
                              $ref: '#/components/schemas/Session'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Users]
      summary: Revoke all sessions
      operationId: revokeAllSessions
      description: Revoke all refresh tokens for current user.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
  /users/me/sessions/{fingerprint}:
    delete:
      tags: [Users]
      summary: Revoke session by fingerprint
      operationId: revokeSessionByFingerprint
      description: Revoke a single session fingerprint.
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/fingerprint'
      responses:
        '200':
          description: Revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
  /users/me/change-password:
    post:
      tags: [Users]
      summary: Change password
      operationId: changeMyPassword
      description: Change password with current password, protected by sensitive limiter and email cost.
      x-rateLimit:
        limit: 60
        window: minute
        note: authenticatedLimiter + sensitiveActionLimiter + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Changed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
  /users/me/api-keys:
    get:
      tags: [Users]
      summary: List API keys
      operationId: listApiKeys
      description: List API keys for the authenticated user.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Keys
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          apiKeys:
                            type: array
                            items:
                              $ref: '#/components/schemas/ApiKey'
        '401':
          $ref: '#/components/responses/AuthError'
    post:
      tags: [Users]
      summary: Create API key
      operationId: createApiKey
      description: Create a new API key.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                expiresAt:
                  type: string
                  format: date-time
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ApiKeyCreated'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/Conflict'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Users]
      summary: Revoke API keys
      operationId: revokeApiKeys
      description: Revoke an API key by name or id; when neither is supplied, revokes all keys.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                name:
                  type: string
      responses:
        '200':
          description: Revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
  /users/me/stats:
    get:
      tags: [Users, Stats]
      summary: User stats
      operationId: getMyStats
      description: Retrieve per-user statistics (sessions, api keys, books summary). Uses statsLimiter.
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter keyed by user.id
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          stats:
                            type: object
              examples:
                stats:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.12"
                    message: User stats retrieved successfully.
                    data:
                      stats:
                        accountAgeDays: 320
                        activityRecencyDays: 2
                        isVerified: true
                        passwordSet: true
                        passwordFreshnessDays: 45
                        profileCompletenessScore: 100
                        books: 48
                        deletedBooks: 2
                        authors: 20
                        deletedAuthors: 1
                        publishers: 8
                        deletedPublishers: 0
                        series: 6
                        deletedSeries: 1
                        bookTypes: 5
                        tags: 12
                        languages: 4
                        storageLocations: 6
                        bookCopies: 70
                        apiKeys: 2
                    errors: []
        '429':
          $ref: '#/components/responses/RateLimit'
  /booktype:
    get:
      tags: [BookTypes]
      summary: List or fetch book types
      operationId: listBookTypes
      description: List book types with filtering or fetch a single record by id/name. JSON body and query fields are both accepted; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeListRequest'
            examples:
              listSorted:
                summary: List book types with filters
                value:
                  sortBy: name
                  order: asc
                  limit: 20
                  filterName: cover
              singleByName:
                summary: Fetch single by name with stats
                value:
                  name: Hardcover
                  returnStats: true
      responses:
        '200':
          description: Book types
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookTypeList'
              examples:
                successList:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.41"
                    message: Book types retrieved successfully.
                    data:
                      bookTypes:
                        - id: 1
                          name: Hardcover
                          description: Hardback edition with rigid cover.
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                        - id: 2
                          name: Softcover
                          description: null
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
                statsIncluded:
                  summary: Single result with stats
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.58"
                    message: Book type retrieved successfully.
                    data:
                      bookTypes:
                        - id: 1
                          name: Hardcover
                          description: Hardback edition with rigid cover.
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                          stats:
                            bookCount: 12
                            percentageOfBooks: 60.0
                            avgPageCount: 510.25
                    errors: []
                notFound:
                  value:
                    status: error
                    httpCode: 404
                    responseTime: "2.84"
                    message: Book type not found.
                    data: {}
                    errors:
                      - The requested book type could not be located.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [BookTypes]
      summary: Create book type
      operationId: createBookType
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeCreate'
            examples:
              create:
                summary: Create a new book type
                value:
                  name: Illustrated Edition
                  description: Special edition with collector illustrations.
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "4.33"
                    message: Book type created successfully.
                    data:
                      id: 10
                      name: Illustrated Edition
                      description: Special edition with collector illustrations.
                      createdAt: "2025-01-17T10:02:11.000Z"
                      updatedAt: "2025-01-17T10:02:11.000Z"
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/Conflict'
    put:
      tags: [BookTypes]
      summary: Update book type (by id or name)
      operationId: updateBookType
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeUpdateFlexible'
            examples:
              updateById:
                summary: Update book type by id
                value:
                  id: 10
                  name: Hardcover
                  description: Updated description.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.92"
                    message: Book type updated successfully.
                    data:
                      id: 10
                      name: Hardcover
                      description: Updated description.
                      createdAt: "2025-01-17T10:02:11.000Z"
                      updatedAt: "2025-01-17T10:05:48.000Z"
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [BookTypes]
      summary: Delete book type (by id or name)
      operationId: deleteBookType
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeDeleteFlexible'
            examples:
              deleteByName:
                summary: Delete by name
                value:
                  name: Hardcover
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Book type deleted successfully.
                    data:
                      id: 10
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
  /booktype/stats:
    get:
      tags: [BookTypes, Stats]
      summary: Book type statistics
      operationId: getBookTypeStats
      description: Aggregate counts and averages for book types. Body fields may also be provided via query.
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeStatsRequest'
            examples:
              allFields:
                summary: Request all stats
                value:
                  fields:
                    - bookTypeBreakdown
                    - mostCollectedType
                    - leastCollectedType
                    - avgPageCountByType
                    - booksMissingType
                    - breakdownPerBookType
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookTypeStatsResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.64"
                    message: Book type stats retrieved successfully.
                    data:
                      stats:
                        bookTypeBreakdown:
                          - id: 1
                            name: Hardcover
                            bookCount: 12
                            percentage: 60.0
                          - id: 2
                            name: Softcover
                            bookCount: 8
                            percentage: 40.0
                        mostCollectedType:
                          id: 1
                          name: Hardcover
                          bookCount: 12
                          percentage: 60.0
                        leastCollectedType:
                          id: 2
                          name: Softcover
                          bookCount: 8
                          percentage: 40.0
                        avgPageCountByType:
                          - id: 1
                            name: Hardcover
                            avgPageCount: 510.25
                        booksMissingType: 0
                        breakdownPerBookType:
                          - id: 1
                            name: Hardcover
                            bookCount: 12
                            percentage: 60.0
                            avgPageCount: 510.25
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
  /booktype/{id}:
    get:
      tags: [BookTypes]
      summary: Get book type by id
      operationId: getBookTypeById
      description: Retrieve a book type and optionally include stats.
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                returnStats:
                  type: boolean
            examples:
              includeStats:
                summary: Include stats
                value:
                  returnStats: true
      responses:
        '200':
          description: Book type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.02"
                    message: Book type retrieved successfully.
                    data:
                      id: 2
                      name: Softcover
                      description: null
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                      stats:
                        bookCount: 8
                        percentageOfBooks: 40.0
                        avgPageCount: 342.5
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [BookTypes]
      summary: Update book type by id
      operationId: updateBookTypeById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookTypeUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [BookTypes]
      summary: Delete book type by id
      operationId: deleteBookTypeById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
  /booktype/by-name:
    get:
      tags: [BookTypes]
      summary: Get book type by name
      operationId: getBookTypeByName
      description: Retrieve a book type by name, optionally include stats. Body and query accepted; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                id:
                  type: integer
                name:
                  type: string
                returnStats:
                  type: boolean
            examples:
              byName:
                summary: Lookup by name
                value:
                  name: Hardcover
                  returnStats: true
      responses:
        '200':
          description: Book type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.78"
                    message: Book type retrieved successfully.
                    data:
                      id: 1
                      name: Hardcover
                      description: Hardback edition with rigid cover.
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                      stats:
                        bookCount: 12
                        percentageOfBooks: 60.0
                        avgPageCount: 510.25
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
  /author:
    get:
      tags: [Authors]
      summary: List or fetch authors
      operationId: listAuthors
      description: List authors with filtering or fetch single by id/name. Body fields also allowed via query; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorListRequest'
            examples:
              listDeceased:
                summary: List deceased authors sorted by death year
                value:
                  filterDeceased: true
                  sortBy: deathYear
                  order: desc
                  limit: 20
              singleByName:
                summary: Fetch single by display name with stats
                value:
                  displayName: "J.R.R. Tolkien"
                  returnStats: true
      responses:
        '200':
          description: Authors
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthorList'
              examples:
                list:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.78"
                    message: Authors retrieved successfully.
                    data:
                      authors:
                        - id: 1
                          displayName: "J.R.R. Tolkien"
                          firstNames: "John Ronald Reuel"
                          lastName: Tolkien
                          birthDate:
                            id: 12
                            day: 3
                            month: 1
                            year: 1892
                            text: "3 January 1892"
                          deceased: true
                          deathDate:
                            id: 13
                            day: 2
                            month: 9
                            year: 1973
                            text: "2 September 1973"
                          bio: Author of The Lord of the Rings.
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
                stats:
                  summary: Single author with stats
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.90"
                    message: Author retrieved successfully.
                    data:
                      authors:
                        - id: 1
                          displayName: "J.R.R. Tolkien"
                          firstNames: "John Ronald Reuel"
                          lastName: Tolkien
                          birthDate:
                            id: 12
                            day: 3
                            month: 1
                            year: 1892
                            text: "3 January 1892"
                          deceased: true
                          deathDate:
                            id: 13
                            day: 2
                            month: 9
                            year: 1973
                            text: "2 September 1973"
                          bio: Author of The Lord of the Rings.
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                          stats:
                            bookCount: 6
                            percentageOfBooks: 12.5
                            firstPublicationYear: 1937
                            lastPublicationYear: 1973
                    errors: []
                notFound:
                  value:
                    status: error
                    httpCode: 404
                    responseTime: "2.84"
                    message: Author not found.
                    data: {}
                    errors:
                      - The requested author could not be located.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [Authors]
      summary: Create author
      operationId: createAuthor
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorCreate'
            examples:
              create:
                summary: Create author
                value:
                  displayName: "J.R.R. Tolkien"
                  firstNames: "John Ronald Reuel"
                  lastName: Tolkien
                  birthDate:
                    day: 3
                    month: 1
                    year: 1892
                    text: "3 January 1892"
                  deceased: true
                  deathDate:
                    day: 2
                    month: 9
                    year: 1973
                    text: "2 September 1973"
                  bio: English writer and philologist.
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "4.33"
                    message: Author created successfully.
                    data:
                      id: 10
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/Conflict'
    put:
      tags: [Authors]
      summary: Update author by body (id or displayName)
      operationId: updateAuthor
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorUpdateFlexible'
            examples:
              updateByName:
                summary: Update author using displayName
                value:
                  displayName: "J.R.R. Tolkien"
                  bio: Updated bio text.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.92"
                    message: Author updated successfully.
                    data:
                      id: 10
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [Authors]
      summary: Delete author (by id or displayName)
      operationId: deleteAuthor
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorDeleteFlexible'
            examples:
              deleteById:
                summary: Delete author by id
                value:
                  id: 10
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Author deleted successfully.
                    data:
                      id: 10
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
  /author/{id}:
    get:
      tags: [Authors]
      summary: Get author by id
      operationId: getAuthorById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                returnStats:
                  type: boolean
            examples:
              includeStats:
                summary: Include stats
                value:
                  returnStats: true
      responses:
        '200':
          description: Author
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.02"
                    message: Author retrieved successfully.
                    data:
                      id: 1
                      displayName: "J.R.R. Tolkien"
                      firstNames: "John Ronald Reuel"
                      lastName: Tolkien
                      birthDate:
                        id: 12
                        day: 3
                        month: 1
                        year: 1892
                        text: "3 January 1892"
                      deceased: true
                      deathDate:
                        id: 13
                        day: 2
                        month: 9
                        year: 1973
                        text: "2 September 1973"
                      bio: Author of The Lord of the Rings.
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                      stats:
                        bookCount: 6
                        percentageOfBooks: 30.0
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Authors]
      summary: Update author by id
      operationId: updateAuthorById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [Authors]
      summary: Delete author by id
      operationId: deleteAuthorById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
  /author/by-name:
    get:
      tags: [Authors]
      summary: Get author by name
      operationId: getAuthorByName
      description: Retrieve author by displayName. Body and query accepted; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              required: [displayName]
              properties:
                id:
                  type: integer
                displayName:
                  type: string
                returnStats:
                  type: boolean
            examples:
              byName:
                summary: Lookup by display name
                value:
                  displayName: "J.R.R. Tolkien"
                  returnStats: true
      responses:
        '200':
          description: Author
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.78"
                    message: Author retrieved successfully.
                    data:
                      id: 1
                      displayName: "J.R.R. Tolkien"
                      firstNames: "John Ronald Reuel"
                      lastName: Tolkien
                      birthDate:
                        id: 12
                        day: 3
                        month: 1
                        year: 1892
                        text: "3 January 1892"
                      deceased: true
                      deathDate:
                        id: 13
                        day: 2
                        month: 9
                        year: 1973
                        text: "2 September 1973"
                      bio: Author of The Lord of the Rings.
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                      stats:
                        bookCount: 6
                        percentageOfBooks: 30.0
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
  /author/trash:
    get:
      tags: [Authors]
      summary: List deleted authors
      operationId: listDeletedAuthors
      description: List authors with deleted_at set.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Deleted authors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.60"
                    message: Deleted authors retrieved successfully.
                    data:
                      authors:
                        - id: 5
                          displayName: "Sample Deleted Author"
                          deletedAt: "2025-02-01T10:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /author/restore:
    post:
      tags: [Authors]
      summary: Restore deleted author
      operationId: restoreAuthor
      description: Restore soft-deleted author by id.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: integer
            examples:
              restore:
                summary: Restore by id
                value:
                  id: 5
      responses:
        '200':
          description: Restored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Author restored successfully.
                    data:
                      id: 5
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /author/stats:
    get:
      tags: [Authors, Stats]
      summary: Author stats
      operationId: getAuthorStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorStatsRequest'
            examples:
              default:
                value:
                  fields:
                    - bookCount
                    - percentageOfBooks
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.50"
                    message: Author stats retrieved successfully.
                    data:
                      stats:
                        total: 12
                        deleted: 1
                        deceased: 7
                        alive: 5
                        withBirthDate: 10
                        withDeathDate: 6
                        withBio: 9
                        earliestBirthYear: 1819
                        latestBirthYear: 1995
                        earliestDeathYear: 1892
                        latestDeathYear: 2020
                        aliveDeceasedRatio:
                          alive: 5
                          deceased: 7
                          deceasedToAliveRatio: 1.4
                        mostRepresentedAuthor:
                          id: 1
                          displayName: "J.R.R. Tolkien"
                          bookCount: 6
                          percentageOfBooks: 30.0
                        authorsWithNoBooks:
                          - id: 9
                            displayName: "New Author"
                            createdAt: "2025-02-01T10:10:00.000Z"
                        oldestAuthor:
                          id: 2
                          displayName: "George Eliot"
                          birthYear: 1819
                        youngestAuthor:
                          id: 11
                          displayName: "Contemporary Writer"
                          birthYear: 1995
                        authorDiscoveryTimeline:
                          - id: 1
                            displayName: "J.R.R. Tolkien"
                            createdAt: "2025-01-05T09:00:00.000Z"
                          - id: 2
                            displayName: "George Eliot"
                            createdAt: "2025-01-12T11:00:00.000Z"
                        breakdownPerAuthor:
                          - id: 1
                            displayName: "J.R.R. Tolkien"
                            bookCount: 6
                            percentageOfBooks: 30.0
                          - id: 3
                            displayName: "C.S. Lewis"
                            bookCount: 4
                            percentageOfBooks: 20.0
                        breakdownPerBirthDecade:
                          - decade: 1890
                            authorCount: 3
                            percentageOfAuthors: 25.0
                          - decade: 1950
                            authorCount: 6
                            percentageOfAuthors: 50.0
                        breakdownPerAliveDeceased:
                          - deceased: false
                            authorCount: 5
                            percentageOfAuthors: 41.7
                          - deceased: true
                            authorCount: 7
                            percentageOfAuthors: 58.3
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
  /bookauthor/stats:
    get:
      tags: [Authors, Stats]
      summary: Book-author link stats
      operationId: getBookAuthorStats
      description: Stats on book-author relationships.
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Book-author stats retrieved successfully.
                    data:
                      stats:
                        averageAuthorsPerBook: 1.6
                        singleVsMultiBreakdown:
                          totalBooks: 10
                          singleAuthorBooks: 6
                          multiAuthorBooks: 3
                          noAuthorBooks: 1
                          singleAuthorPercentage: 60.0
                          multiAuthorPercentage: 30.0
                          noAuthorPercentage: 10.0
                        contributorDiversity:
                          distinctAuthors: 8
                          totalBooks: 10
                          score: 0.8
                        authorRoleBreakdown:
                          - role: Primary Author
                            count: 7
                            percentage: 58.3
                          - role: Editor
                            count: 3
                            percentage: 25.0
                          - role: Illustrator
                            count: 2
                            percentage: 16.7
                        collaborationPairs:
                          - authors:
                              - id: 1
                                displayName: "J.R.R. Tolkien"
                              - id: 2
                                displayName: "C.S. Lewis"
                            bookCount: 2
                            percentageOfCoauthoredBooks: 66.7
                          - authors:
                              - id: 3
                                displayName: "Neil Gaiman"
                              - id: 4
                                displayName: "Terry Pratchett"
                            bookCount: 1
                            percentageOfCoauthoredBooks: 33.3
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /publisher:
    get:
      tags: [Publishers]
      summary: List or fetch publishers
      operationId: listPublishers
      description: List publishers with filtering or fetch single by id/name. Body accepted for filters and overrides query.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherListRequest'
            examples:
              listPublishers:
                summary: List publishers with name filter
                value:
                  filterName: press
                  sortBy: name
                  order: asc
                  limit: 10
      responses:
        '200':
          description: Publishers
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        oneOf:
                        - $ref: '#/components/schemas/PublisherList'
                        - $ref: '#/components/schemas/Publisher'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Publishers retrieved successfully.
                    data:
                      publishers:
                        - id: 5
                          name: Allen & Unwin
                          foundedDate:
                            id: 14
                            year: 1910
                            text: "1910"
                          website: https://example.com
                          notes: Classic literature publisher.
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [Publishers]
      summary: Create publisher
      operationId: createPublisher
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherCreate'
            examples:
              create:
                summary: Create publisher
                value:
                  name: HarperCollins
                  foundedDate:
                    year: 1989
                    text: "1989"
                  website: https://harpercollins.example.com
                  notes: Major publisher.
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.90"
                    message: Publisher created successfully.
                    data:
                      id: 11
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [Publishers]
      summary: Update publisher (by id or name)
      operationId: updatePublisher
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherUpdateFlexible'
            examples:
              update:
                summary: Update by name
                value:
                  targetName: Allen & Unwin
                  website: https://allen-unwin.example.com
                  notes: Updated notes.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.20"
                    message: Publisher updated successfully.
                    data:
                      id: 5
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [Publishers]
      summary: Delete publisher (by id or name)
      operationId: deletePublisher
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherDeleteFlexible'
            examples:
              delete:
                summary: Delete by id
                value:
                  id: 5
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Publisher deleted successfully.
                    data:
                      id: 5
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /publisher/{id}:
    get:
      tags: [Publishers]
      summary: Get publisher by id
      operationId: getPublisherById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                returnStats:
                  type: boolean
      responses:
        '200':
          description: Publisher
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Publisher'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.90"
                    message: Publisher retrieved successfully.
                    data:
                      id: 5
                      name: Allen & Unwin
                      foundedDate:
                        id: 14
                        year: 1910
                        text: "1910"
                      website: https://example.com
                      notes: Classic literature publisher.
                      createdAt: "2025-01-10T09:15:23.000Z"
                      updatedAt: "2025-01-14T16:58:41.000Z"
                      stats:
                        bookCount: 30
                        percentageOfBooks: 25.0
                        avgPageCount: 420.5
                    errors: []
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [Publishers]
      summary: Update publisher by id
      operationId: updatePublisherById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '409':
          $ref: '#/components/responses/Conflict'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Publishers]
      summary: Delete publisher by id
      operationId: deletePublisherById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
  /publisher/by-name:
    get:
      tags: [Publishers]
      summary: Get publisher by name
      operationId: getPublisherByName
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                id:
                  type: integer
                name:
                  type: string
                returnStats:
                  type: boolean
      responses:
        '200':
          description: Publisher
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Publisher'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.70"
                    message: Publisher retrieved successfully.
                    data:
                      id: 6
                      name: HarperCollins
                      foundedDate:
                        id: 21
                        year: 1989
                        text: "1989"
                      website: https://harpercollins.example.com
                      notes: Global publishing house.
                      createdAt: "2025-01-11T10:00:00.000Z"
                      updatedAt: "2025-01-15T16:00:00.000Z"
                      stats:
                        bookCount: 18
                        percentageOfBooks: 15.0
                        avgPageCount: 380.0
                    errors: []
        '404':
          $ref: '#/components/responses/NotFound'
  /publisher/trash:
    get:
      tags: [Publishers]
      summary: List deleted publishers
      operationId: listDeletedPublishers
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Deleted publishers
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PublisherList'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Deleted publishers retrieved successfully.
                    data:
                      publishers:
                        - id: 9
                          name: Old Press
                          deletedAt: "2025-02-01T10:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /publisher/restore:
    post:
      tags: [Publishers]
      summary: Restore deleted publisher
      operationId: restorePublisher
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: integer
            examples:
              restore:
                value:
                  id: 9
      responses:
        '200':
          description: Restored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Publisher restored successfully.
                    data:
                      id: 9
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /publisher/stats:
    get:
      tags: [Publishers, Stats]
      summary: Publisher stats
      operationId: getPublisherStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublisherStatsRequest'
            examples:
              default:
                value:
                  fields: ["publisherBreakdown", "mostUsedPublisher"]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Publisher stats retrieved successfully.
                    data:
                      stats:
                        total: 12
                        deleted: 1
                        withWebsite: 8
                        publishersWithNoBooks:
                          - id: 9
                            name: Small Indie Press
                            bookCount: 0
                        oldestFoundedPublisher:
                          id: 5
                          name: Allen & Unwin
                          foundedYear: 1910
                        publisherBreakdown:
                          - id: 5
                            name: Allen & Unwin
                            bookCount: 12
                            percentageOfBooks: 30.0
                          - id: 6
                            name: HarperCollins
                            bookCount: 18
                            percentageOfBooks: 45.0
                        mostUsedPublisher:
                          id: 6
                          name: HarperCollins
                          bookCount: 18
                          percentageOfBooks: 45.0
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries:
    get:
      tags: [Series]
      summary: List or fetch book series
      operationId: listSeries
      description: List series with filters or fetch single by id/name. Body accepted; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesListRequest'
            examples:
              listSeries:
                summary: List series
                value:
                  filterName: Rings
                  sortBy: name
                  order: asc
                  limit: 10
      responses:
        '200':
          description: Series
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        oneOf:
                        - $ref: '#/components/schemas/SeriesList'
                        - $ref: '#/components/schemas/Series'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Series retrieved successfully.
                    data:
                      series:
                        - id: 8
                          name: The Lord of the Rings
                          description: Epic high-fantasy trilogy.
                          website: https://example.com/lotr
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    post:
      tags: [Series]
      summary: Create series
      operationId: createSeries
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesCreate'
            examples:
              create:
                summary: Create series
                value:
                  name: The Stormlight Archive
                  description: Epic fantasy saga.
                  website: https://example.com/stormlight
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.80"
                    message: Series created successfully.
                    data:
                      id: 15
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [Series]
      summary: Update series (by id or name)
      operationId: updateSeries
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesUpdateFlexible'
            examples:
              update:
                summary: Update by id
                value:
                  id: 8
                  description: Updated description text.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.10"
                    message: Series updated successfully.
                    data:
                      id: 8
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Series]
      summary: Delete series (by id or name)
      operationId: deleteSeries
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesDeleteFlexible'
            examples:
              delete:
                summary: Delete by name
                value:
                  name: The Lord of the Rings
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Series deleted successfully.
                    data:
                      id: 8
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/{id}:
    get:
      tags: [Series]
      summary: Get series by id
      operationId: getSeriesById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Series
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Series'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [Series]
      summary: Update series by id
      operationId: updateSeriesById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Series]
      summary: Delete series by id
      operationId: deleteSeriesById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/by-name:
    get:
      tags: [Series]
      summary: Get series by name
      operationId: getSeriesByName
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                id:
                  type: integer
                name:
                  type: string
      responses:
        '200':
          description: Series
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Series'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/link:
    post:
      tags: [BookSeriesLinks]
      summary: Link book to series
      operationId: createSeriesLink
      description: Create series-book link with optional bookOrder.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesLinkRequest'
            examples:
              link:
                summary: Link book to series
                value:
                  seriesId: 8
                  bookId: 22
                  bookOrder: 1
      responses:
        '201':
          description: Linked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "2.90"
                    message: Series link created successfully.
                    data:
                      id: 44
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [BookSeriesLinks]
      summary: Update series link
      operationId: updateSeriesLink
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesLinkRequest'
            examples:
              updateOrder:
                summary: Update book order
                value:
                  seriesId: 8
                  bookId: 22
                  bookOrder: 2
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.80"
                    message: Series link updated successfully.
                    data:
                      id: 44
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [BookSeriesLinks]
      summary: Delete series link
      operationId: deleteSeriesLink
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesLinkDelete'
            examples:
              unlink:
                summary: Unlink book from series
                value:
                  seriesId: 8
                  bookId: 22
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Series link deleted successfully.
                    data:
                      id: 44
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/trash:
    get:
      tags: [Series]
      summary: List deleted series
      operationId: listDeletedSeries
      responses:
        '200':
          description: Deleted series list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SeriesList'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Deleted series retrieved successfully.
                    data:
                      series:
                        - id: 20
                          name: Old Series
                          deletedAt: "2025-02-01T10:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/restore:
    post:
      tags: [Series]
      summary: Restore deleted series
      operationId: restoreSeries
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: integer
            examples:
              restore:
                value:
                  id: 20
      responses:
        '200':
          description: Restored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.20"
                    message: Series restored successfully.
                    data:
                      id: 20
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseries/stats:
    get:
      tags: [Series, Stats]
      summary: Series stats
      operationId: getSeriesStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SeriesStatsRequest'
            examples:
              default:
                value:
                  fields: ["seriesBreakdown", "mostCollectedSeries"]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Series stats retrieved successfully.
                    data:
                      stats:
                        newestSeriesAdded:
                          id: 12
                          name: The Cosmere
                          createdAt: "2025-02-01T12:00:00.000Z"
                        oldestSeriesAdded:
                          id: 8
                          name: The Lord of the Rings
                          createdAt: "2025-01-02T10:00:00.000Z"
                        seriesBreakdown:
                          - id: 8
                            name: The Lord of the Rings
                            bookCount: 3
                            percentage: 12.0
                          - id: 12
                            name: The Cosmere
                            bookCount: 5
                            percentage: 20.0
                        mostCollectedSeries:
                          id: 12
                          name: The Cosmere
                          bookCount: 5
                          percentage: 20.0
                        breakdownPerSeries:
                          - id: 8
                            name: The Lord of the Rings
                            bookCount: 3
                            percentageOfBooks: 12.0
                            totalPages: 1230
                            avgPages: 410.0
                            nullBookOrderCount: 0
                            duplicateOrderNumbers: 0
                            gapCount: 0
                          - id: 12
                            name: The Cosmere
                            bookCount: 5
                            percentageOfBooks: 20.0
                            totalPages: 2750
                            avgPages: 550.0
                            nullBookOrderCount: 1
                            duplicateOrderNumbers: 1
                            gapCount: 2
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookseriesbooks/stats:
    get:
      tags: [BookSeriesLinks, Stats]
      summary: Series-book stats
      operationId: getSeriesBookStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.35"
                    message: Series-book stats retrieved successfully.
                    data:
                      stats:
                        booksInSeries:
                          count: 18
                          percentageOfBooks: 72.0
                        standalones:
                          count: 7
                          percentageOfBooks: 28.0
                        averageSeriesLengthBooks: 4.2
                        averageSeriesLengthPages: 1850.5
                        outOfOrderEntries:
                          nullBookOrderCount: 1
                          gapCount: 3
                        booksInMultipleSeries:
                          count: 4
                          percentageOfBooks: 16.0
                        breakdownPerSeries:
                          - id: 8
                            name: The Lord of the Rings
                            bookCount: 3
                            percentageOfBooks: 12.0
                            totalPages: 1230
                            avgPages: 410.0
                            nullBookOrderCount: 0
                            duplicateOrderNumbers: 0
                            gapCount: 0
                          - id: 12
                            name: The Cosmere
                            bookCount: 5
                            percentageOfBooks: 20.0
                            totalPages: 2750
                            avgPages: 550.0
                            nullBookOrderCount: 1
                            duplicateOrderNumbers: 1
                            gapCount: 2
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /languages:
    get:
      tags: [Languages]
      summary: List languages
      operationId: listLanguages
      description: Return active languages. Auth required.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Languages
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          languages:
                            type: array
                            items:
                              $ref: '#/components/schemas/Language'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.00"
                    message: Languages retrieved successfully.
                    data:
                      languages:
                        - id: 1
                          name: English
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /languages/stats:
    get:
      tags: [Languages, Stats]
      summary: Language stats
      operationId: getLanguageStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.20"
                    message: Language stats retrieved successfully.
                    data:
                      stats:
                        topLanguages:
                          - id: 1
                            name: English
                            bookCount: 45
                            percentage: 45.0
                          - id: 2
                            name: Afrikaans
                            bookCount: 20
                            percentage: 20.0
                        mostCommonLanguages:
                          - id: 1
                            name: English
                            bookCount: 45
                            percentage: 45.0
                        rarestLanguage:
                          id: 5
                          name: Latin
                          bookCount: 2
                          percentage: 2.0
                        languageCombinations:
                          - languages: ["English", "Afrikaans"]
                            bookCount: 6
                            percentage: 6.0
                          - languages: ["English", "French"]
                            bookCount: 3
                            percentage: 3.0
                        languageCoveragePercentage: 92.3
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /book:
    get:
      tags: [Books]
      summary: List or fetch books
      operationId: listBooks
      description: Retrieve books with filters or fetch single by id/isbn/title. Supports optional JSON body; body wins over query. Use `view` to control projection and `returnStats` for a single record.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookListRequest'
            examples:
              filterAndSort:
                summary: Filter, sort, and paginate
                value:
                  view: card
                  sortBy: title
                  order: asc
                  limit: 20
                  offset: 0
                  filterTag: fantasy
                  filterPublishedAfter: "1950-01-01"
                  filterLanguage: English
                  returnStats: false
              singleByIsbn:
                summary: Fetch single by ISBN with stats
                value:
                  isbn: "9780261102354"
                  returnStats: true
      responses:
        '200':
          description: Books
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        oneOf:
                          - $ref: '#/components/schemas/BookList'
                          - $ref: '#/components/schemas/Book'
              examples:
                list:
                  summary: List (card view)
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.18"
                    message: Books retrieved successfully.
                    errors: []
                    data:
                      books:
                        - id: 12
                          title: The Fellowship of the Ring
                          subtitle: Being the First Part of The Lord of the Rings
                          coverImageUrl: https://example.com/fotr.jpg
                          publicationDate:
                            id: 61
                            day: 29
                            month: 7
                            year: 1954
                            text: "29 July 1954"
                          pageCount: 423
                          bookTypeId: 2
                          bookTypeName: Paperback
                          languages:
                            - id: 2
                              name: English
                          tags:
                            - id: 7
                              name: Fantasy
                single:
                  summary: Single record with stats
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.44"
                    message: Book retrieved successfully.
                    errors: []
                    data:
                      id: 22
                      title: The Lord of the Rings
                      subtitle: The Fellowship of the Ring
                      isbn: "9780261102354"
                      publicationDate:
                        id: 61
                        day: 29
                        month: 7
                        year: 1954
                        text: "29 July 1954"
                      pageCount: 423
                      coverImageUrl: https://example.com/lotr-fotr.jpg
                      description: The first volume of The Lord of the Rings.
                      bookType:
                        id: 2
                        name: Paperback
                        description: Flexible-cover print format.
                      publisher:
                        id: 5
                        name: Allen & Unwin
                        foundedDate:
                          id: 14
                          year: 1910
                          text: "1910"
                        website: https://example.com
                        notes: Classic literature publisher.
                      authors:
                        - authorId: 1
                          authorRole: Primary Author
                          authorName: "J.R.R. Tolkien"
                          birthDate:
                            id: 201
                            day: 3
                            month: 1
                            year: 1892
                            text: "3 January 1892"
                          deathDate:
                            id: 202
                            day: 2
                            month: 9
                            year: 1973
                            text: "2 September 1973"
                          deceased: true
                          bio: English writer, poet, and academic.
                      languages:
                        - id: 2
                          name: English
                      tags:
                        - id: 7
                          name: Fantasy
                      series:
                        - seriesId: 8
                          seriesName: The Lord of the Rings
                          bookOrder: 1
                      bookCopies:
                        - id: 502
                          storageLocationId: 12
                          storageLocationPath: Home -> Living Room -> Shelf A
                          acquisitionStory: Gifted for a birthday.
                          acquisitionDate:
                            id: 71
                            day: 21
                            month: 12
                            year: 2010
                            text: "21 December 2010"
                          acquiredFrom: Family
                          acquisitionType: Gift
                          acquisitionLocation: Cape Town
                          notes: Hardcover edition.
                      createdAt: "2025-01-17T10:02:11.000Z"
                      updatedAt: "2025-01-17T10:02:11.000Z"
                      stats:
                        copyCount: 1
                        authorCount: 1
                        tagCount: 1
                        languageCount: 1
                        seriesCount: 1
                        hasIsbn: true
                        hasPublicationDate: true
                        hasCoverImage: true
                        hasDescription: true
                        hasPublisher: true
                        hasBookType: true
                        hasPageCount: true
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    post:
      tags: [Books]
      summary: Create book
      operationId: createBook
      description: Create book with authors, languages, tags, series, and optional initial copy.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCreate'
            examples:
              createWithCopy:
                summary: Create book with authors, tags, and initial copy
                value:
                  title: The Hobbit
                  subtitle: There and Back Again
                  isbn: "9780261103344"
                  publicationDate:
                    day: 21
                    month: 9
                    year: 1937
                    text: "21 September 1937"
                  pageCount: 310
                  coverImageUrl: https://example.com/hobbit.jpg
                  description: Classic fantasy novel.
                  bookTypeId: 2
                  publisherId: 5
                  authors:
                    - authorId: 1
                      authorRole: Primary Author
                  languageIds: [2]
                  tags: ["Fantasy", "Adventure"]
                  series:
                    - seriesId: 8
                      bookOrder: 0
                  bookCopy:
                    storageLocationPath: Home -> Study -> Shelf 1
                    acquisitionStory: Gift from a friend.
                    acquisitionDate:
                      day: 12
                      month: 6
                      year: 2022
                      text: "12 June 2022"
                    acquiredFrom: Second-hand fair
                    acquisitionType: Second-hand
                    acquisitionLocation: Cape Town
                    notes: First edition.
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    message: Book created successfully.
                    data:
                      id: 33
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/Conflict'
    put:
      tags: [Books]
      summary: Update book (by id or title/isbn)
      operationId: updateBook
      description: Update book fields using flexible identifiers.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookUpdateFlexible'
            examples:
              updateTitle:
                summary: Update by id
                value:
                  id: 33
                  title: The Hobbit (Illustrated)
                  description: Updated to illustrated edition.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    message: Book updated successfully.
                    data:
                      id: 33
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
    delete:
      tags: [Books]
      summary: Delete book (by id or title/isbn)
      operationId: deleteBook
      description: Soft-delete a book.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookDeleteFlexible'
            examples:
              deleteById:
                summary: Delete by id
                value:
                  id: 33
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    message: Book deleted successfully.
                    data:
                      id: 33
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
  /book/list:
    post:
      tags: [Books]
      summary: List books (JSON body)
      operationId: listBooksPost
      description: Browser-safe listing endpoint that accepts the same filters as GET /book via JSON body (no reliance on query strings or GET bodies).
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookListRequest'
            examples:
              filterAndSort:
                summary: Filter, sort, and paginate
                value:
                  view: card
                  sortBy: title
                  order: asc
                  limit: 20
                  offset: 0
                  filterTag: fantasy
                  filterLanguage: English
              searchTitle:
                summary: Search by title (body only)
                value:
                  title: fellowship
                  limit: 10
                  offset: 0
      responses:
        '200':
          description: Books
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookList'
              examples:
                list:
                  summary: List response
                  value:
                    status: success
                    httpCode: 200
                    message: Books retrieved successfully.
                    data:
                      books: []
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /book/{id}:
    put:
      tags: [Books]
      summary: Update book by id
      operationId: updateBookById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [Books]
      summary: Delete book by id
      operationId: deleteBookById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
  /book/trash:
    get:
      tags: [Books]
      summary: List deleted books
      operationId: listDeletedBooks
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Deleted books list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookList'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Deleted books retrieved successfully.
                    data:
                      books:
                        - id: 33
                          title: Old Book
                          deletedAt: "2025-02-01T10:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /book/restore:
    post:
      tags: [Books]
      summary: Restore deleted book
      operationId: restoreBook
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id]
              properties:
                id:
                  type: integer
            examples:
              restore:
                value:
                  id: 33
      responses:
        '200':
          description: Restored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Book restored successfully.
                    data:
                      id: 33
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /book/stats:
    get:
      tags: [Books, Stats]
      summary: Book stats
      operationId: getBookStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookStatsRequest'
            examples:
              default:
                value:
                  fields: ["bookTypeBreakdown", "hasIsbnCount"]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.50"
                    message: Book stats retrieved successfully.
                    data:
                      stats:
                        totalBooks: 120
                        deleted: 5
                        hasIsbnCount: 90
                        missingIsbnCount: 30
                        withCoverImage: 80
                        withDescription: 95
                        withPublisher: 70
                        withSeries: 35
                        totalCopies: 145
                        publicationYearHistogram:
                          - year: 1954
                            bookCount: 3
                            percentageOfBooks: 2.5
                          - year: 2020
                            bookCount: 12
                            percentageOfBooks: 10.0
                        oldestPublicationYear: 1890
                        newestPublicationYear: 2024
                        longestBook:
                          id: 80
                          title: "The Stand"
                          pageCount: 1152
                        shortestBook:
                          id: 34
                          title: "The Little Prince"
                          pageCount: 96
                        bookTypeBreakdown:
                          - id: 1
                            name: Hardcover
                            bookCount: 60
                            percentage: 50.0
                          - id: 2
                            name: Paperback
                            bookCount: 40
                            percentage: 33.3
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /storagelocation:
    get:
      tags: [StorageLocations]
      summary: List or fetch storage locations
      operationId: listStorageLocations
      description: List storage locations with tree paths; filter by id/name/parent. Body overrides query.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationListRequest'
            examples:
              listTree:
                summary: List storage locations under parent
                value:
                  parentId: 1
                  includeNested: true
                  limit: 50
      responses:
        '200':
          description: Storage locations
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/StorageLocationList'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Storage locations retrieved successfully.
                    data:
                      storageLocations:
                        - id: 3
                          name: Living Room
                          parentId: 1
                          notes: Main shelf
                          path: Home -> Living Room
                          createdAt: "2025-01-10T09:15:23.000Z"
                          updatedAt: "2025-01-14T16:58:41.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    post:
      tags: [StorageLocations]
      summary: Create storage location
      operationId: createStorageLocation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationCreate'
            examples:
              create:
                summary: Create nested location
                value:
                  name: Shelf A
                  parentId: 3
                  notes: Top shelf
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.00"
                    message: Storage location created successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [StorageLocations]
      summary: Update storage location (flexible)
      operationId: updateStorageLocation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationUpdateFlexible'
            examples:
              update:
                summary: Update by id
                value:
                  id: 12
                  name: Shelf A (Left)
                  notes: Moved items left side
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.80"
                    message: Storage location updated successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [StorageLocations]
      summary: Delete storage location (flexible)
      operationId: deleteStorageLocation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationDeleteFlexible'
            examples:
              delete:
                summary: Delete by name
                value:
                  name: Shelf A
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Storage location deleted successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /storagelocation/{id}:
    put:
      tags: [StorageLocations]
      summary: Update storage location by id
      operationId: updateStorageLocationById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [StorageLocations]
      summary: Delete storage location by id
      operationId: deleteStorageLocationById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
  /storagelocation/{id}/bookcopies:
    get:
      tags: [StorageLocations, BookCopies]
      summary: List book copies in storage location
      operationId: listBookCopiesByLocation
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                includeNested:
                  type: boolean
            examples:
              includeNested:
                value:
                  includeNested: true
      responses:
        '200':
          description: Copies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Book copies retrieved successfully.
                    data:
                      bookCopies:
                        - id: 503
                          bookId: 22
                          storageLocationId: 3
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /storagelocation/bookcopies:
    get:
      tags: [StorageLocations, BookCopies]
      summary: List book copies by storage path filter
      operationId: listBookCopiesWithLocations
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                storageLocationPath:
                  type: string
                includeNested:
                  type: boolean
            examples:
              filterByPath:
                value:
                  storageLocationPath: Home -> Living Room
                  includeNested: true
      responses:
        '200':
          description: Copies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Book copies retrieved successfully.
                    data:
                      bookCopies:
                        - id: 503
                          bookId: 22
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /storagelocation/stats:
    get:
      tags: [StorageLocations, Stats]
      summary: Storage stats
      operationId: getStorageLocationStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorageLocationStatsRequest'
            examples:
              default:
                value:
                  fields: ["locationBreakdown", "mostUsedLocation"]
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Storage stats retrieved successfully.
                    data:
                      stats:
                        mostUsedLocation:
                          id: 3
                          name: Living Room
                          copyCount: 42
                          directCopyCount: 30
                          nestedCopyCount: 12
                          percentageOfCopies: 35.0
                        locationBreakdown:
                          - id: 3
                            name: Living Room
                            copyCount: 42
                            directCopyCount: 30
                            nestedCopyCount: 12
                            percentageOfCopies: 35.0
                          - id: 7
                            name: Study
                            copyCount: 25
                            directCopyCount: 18
                            nestedCopyCount: 7
                            percentageOfCopies: 20.8
                          - id: 10
                            name: Archive Boxes
                            copyCount: 12
                            directCopyCount: 12
                            nestedCopyCount: 0
                            percentageOfCopies: 10.0
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /timeline/buckets:
    post:
      tags: [Timeline, Stats]
      summary: Timeline buckets
      operationId: getTimelineBuckets
      description: Build histogram buckets for books or acquisitions. Uses statsLimiter and accepts manual or auto bucket configuration.
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TimelineBucketsRequest'
            examples:
              manual:
                summary: Manual bucket definition
                value:
                  entity: books
                  field: datePublished
                  start: 1950-01-01
                  end: 1960-01-01
                  step: 2
                  stepUnit: year
                  hideEmptyBuckets: false
              auto:
                summary: Auto mode
                value:
                  entity: books
                  field: datePublished
                  auto: true
                  numberOfBuckets: 12
                  hideEmptyBuckets: false
      responses:
        '200':
          description: Buckets
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TimelineBucketsResponse'
              examples:
                successAuto:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Timeline buckets retrieved successfully.
                    data:
                      entity: books
                      field: datePublished
                      start: "1937-09-21"
                      end: "1961-09-21"
                      step: 2
                      stepUnit: year
                      numberOfBuckets: 12
                      hideEmptyBuckets: false
                      beforeStart: 0
                      afterEnd: 0
                      unknown: 7
                      buckets:
                        - start: "1937-09-21"
                          end: "1939-09-21"
                          label: "21 September 1937 to 20 September 1939"
                          count: 1
                        - start: "1939-09-21"
                          end: "1941-09-21"
                          label: "21 September 1939 to 20 September 1941"
                          count: 0
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
  /bookcopy:
    get:
      tags: [BookCopies]
      summary: List or fetch book copies
      operationId: listBookCopies
      description: Retrieve copies with filters or single by id. Body accepted; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCopyListRequest'
            examples:
              listByLocation:
                summary: List copies under a storage path
                value:
                  filterStorageLocationPath: Home -> Living Room
                  includeNested: true
                  sortBy: createdAt
                  order: desc
                  limit: 50
              singleById:
                summary: Fetch single copy
                value:
                  id: 503
      responses:
        '200':
          description: Book copies
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        oneOf:
                          - $ref: '#/components/schemas/BookCopyList'
                          - $ref: '#/components/schemas/BookCopy'
              examples:
                list:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.52"
                    message: Book copies retrieved successfully.
                    data:
                      bookCopies:
                        - id: 503
                          bookId: 22
                          storageLocationId: 3
                          storageLocationPath: Home -> Living Room -> Shelf A
                          acquisitionStory: Found at a local book fair.
                          acquisitionDate:
                            day: 12
                            month: 6
                            year: 2022
                            text: "12 June 2022"
                          acquiredFrom: Second-hand fair
                          acquisitionType: Second-hand
                          acquisitionLocation: Cape Town
                          notes: Signed by the author.
                          createdAt: "2025-01-17T10:02:11.000Z"
                          updatedAt: "2025-01-17T10:02:11.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    post:
      tags: [BookCopies]
      summary: Create book copy
      operationId: createBookCopy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/BookCopyCreate'
                - type: object
                  required: [bookId]
            examples:
              default:
                summary: Create copy with storage path
                value:
                  bookId: 22
                  storageLocationPath: Home -> Living Room -> Shelf A
                  acquisitionStory: Found at a local book fair.
                  acquisitionDate:
                    day: 12
                    month: 6
                    year: 2022
                    text: "12 June 2022"
                  acquiredFrom: Second-hand fair
                  acquisitionType: Second-hand
                  acquisitionLocation: Cape Town
                  notes: Signed by the author.
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.02"
                    message: Book copy created successfully.
                    data:
                      id: 503
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    put:
      tags: [BookCopies]
      summary: Update book copy (flexible)
      operationId: updateBookCopy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCopyUpdateFlexible'
            examples:
              updateNotes:
                summary: Update copy by id
                value:
                  id: 503
                  storageLocationId: 3
                  acquisitionStory: Gift from a friend.
                  notes: Dust jacket included.
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.90"
                    message: Book copy updated successfully.
                    data:
                      id: 503
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [BookCopies]
      summary: Delete book copy (flexible)
      operationId: deleteBookCopy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCopyDeleteFlexible'
            examples:
              deleteCopy:
                summary: Delete copy by id
                value:
                  id: 503
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.48"
                    message: Book copy deleted successfully.
                    data:
                      id: 503
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /bookcopy/{id}:
    put:
      tags: [BookCopies]
      summary: Update book copy by id
      operationId: updateBookCopyById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCopyUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
    delete:
      tags: [BookCopies]
      summary: Delete book copy by id
      operationId: deleteBookCopyById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/AuthError'
  /bookcopy/stats:
    get:
      tags: [BookCopies, Stats]
      summary: Book copy stats
      operationId: getBookCopyStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCopyStatsRequest'
            examples:
              breakdown:
                value:
                  fields:
                    - totalCopies
                    - uniqueVsDuplicate
                    - storageCoverage
                  breakdownLimit: 10
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.52"
                    message: Book copy stats retrieved successfully.
                    data:
                      stats:
                        totalCopies: 145
                        uniqueVsDuplicate:
                          uniqueBooks: 120
                          duplicateCopies: 25
                          uniqueBooksPercentage: 82.8
                          duplicateCopiesPercentage: 17.2
                        storageCoverage:
                          withStorageLocation: 110
                          totalCopies: 145
                          percentage: 75.9
                        acquiredFromBreakdown:
                          - value: Purchased New
                            count: 60
                            percentage: 41.4
                          - value: Gift
                            count: 35
                            percentage: 24.1
                        topAcquisitionType:
                          value: Purchased New
                          count: 60
                          percentage: 41.4
                        topAcquisitionLocation:
                          value: Cape Town
                          count: 22
                          percentage: 15.2
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /tags:
    get:
      tags: [Tags]
      summary: List tags
      operationId: listTags
      description: List tags with optional filters.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                filterName:
                  type: string
                limit:
                  type: integer
                offset:
                  type: integer
            examples:
              list:
                value:
                  filterName: fan
                  limit: 20
      responses:
        '200':
          description: Tags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.10"
                    message: Tags retrieved successfully.
                    data:
                      tags:
                        - id: 7
                          name: Fantasy
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /search:
    get:
      tags: [Search]
      summary: Search entities
      operationId: searchEntities
      description: Multi-entity search across books, authors, publishers, series, tags. Accepts query or JSON body; body wins.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
            examples:
              multiEntity:
                value:
                  query: ring
                  include: [books, authors, series]
                  limit: 5
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Search completed.
                    data:
                      books:
                        - id: 22
                          title: The Lord of the Rings
                      authors:
                        - id: 1
                          displayName: "J.R.R. Tolkien"
                      series:
                        - id: 8
                          name: The Lord of the Rings
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /tags/stats:
    get:
      tags: [Tags, Stats]
      summary: Tag stats
      operationId: getTagStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: Tag stats retrieved successfully.
                    data:
                      stats:
                        topTags:
                          - name: Fantasy
                            count: 34
                            percentageOfBooks: 28.3
                          - name: Sci-Fi
                            count: 20
                            percentageOfBooks: 16.7
                        leastUsedTags:
                          - id: 9
                            name: Essays
                            bookCount: 1
                            percentageOfBooks: 0.8
                        unusedTags:
                          - id: 12
                            name: Wishlist
                        totalTags: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /booktags/stats:
    get:
      tags: [Tags, Stats]
      summary: Book-tag stats
      operationId: getBookTagStats
      x-rateLimit:
        limit: 20
        window: minute
        note: statsLimiter
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.25"
                    message: Book-tag stats retrieved successfully.
                    data:
                      stats:
                        averageTagsPerBook: 2.4
                        untaggedBooks:
                          count: 5
                          percentageOfBooks: 4.2
                        tagCoveragePercentage: 78.5
                        mostTaggedBook:
                          bookId: 22
                          title: The Lord of the Rings
                          tagCount: 5
                        coOccurringTags:
                          - tags: ["Fantasy", "Adventure"]
                            bookCount: 12
                            percentageOfBooks: 10.0
                          - tags: ["Fantasy", "Magic"]
                            bookCount: 9
                            percentageOfBooks: 7.5
                        tagEntropy: 1.85
                        tagBreakdown:
                          - id: 7
                            name: Fantasy
                            bookCount: 34
                            percentageOfBooks: 28.3
                          - id: 8
                            name: Adventure
                            bookCount: 26
                            percentageOfBooks: 21.7
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /export:
    get:
      tags: [ImportExport]
      summary: Export data
      operationId: exportData
      description: Export full dataset as JSON. Auth required.
      x-rateLimit:
        limit: 60
        window: minute
      responses:
        '200':
          description: Export payload
          content:
            application/json:
              schema:
                type: object
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "5.10"
                    message: Export completed.
                    data:
                      users: []
                      books: []
                      authors: []
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
  /import:
    post:
      tags: [ImportExport]
      summary: Import data
      operationId: importData
      description: Import dataset; may overwrite/merge.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dryRun:
                  type: boolean
                data:
                  type: object
            examples:
              dryRun:
                summary: Dry-run import
                value:
                  dryRun: true
                  data:
                    books:
                      - title: Sample
                        isbn: "1234567890"
      responses:
        '200':
          description: Imported
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "6.00"
                    message: Import processed.
                    data:
                      dryRun: true
                      inserted:
                        books: 1
                    errors: []
        '400':
          $ref: '#/components/responses/ValidationError'
  /logs:
    get:
      tags: [Logs]
      summary: List logs
      operationId: listLogs
      description: Retrieve logs with filters. Body allowed; body wins.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogListRequest'
            examples:
              listLogs:
                summary: List logs for user
                value:
                  filterUserId: 12
                  limit: 20
                  sortBy: createdAt
                  order: desc
      responses:
        '200':
          description: Logs
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/LogEntry'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.40"
                    message: Logs retrieved successfully.
                    data:
                      logs:
                        - id: 101
                          action: LOGIN_ATTEMPT
                          status: SUCCESS
                          userId: 12
                          createdAt: "2025-02-05T10:21:44.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /logs/search:
    post:
      tags: [Logs]
      summary: Search logs
      operationId: searchLogs
      description: Advanced log search with filters/sorting and JSON body.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogListRequest'
            examples:
              search:
                summary: Search logs by status and action
                value:
                  filterAction: USER_REGISTERED
                  filterStatus: FAILURE
                  limit: 10
      responses:
        '200':
          description: Logs
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/LogEntry'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.35"
                    message: Logs retrieved successfully.
                    data:
                      logs: []
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /logs/log_types:
    get:
      tags: [Logs]
      summary: Log types
      operationId: listLogTypes
      responses:
        '200':
          description: Types
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "1.90"
                    message: Log types retrieved successfully.
                    data:
                      logTypes: ["HTTP_REQUEST", "USER_REGISTERED", "LOGIN_ATTEMPT"]
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /logs/levels:
    get:
      tags: [Logs]
      summary: Log levels
      operationId: listLogLevels
      responses:
        '200':
          description: Levels
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "1.90"
                    message: Log levels retrieved successfully.
                    data:
                      levels: ["info", "warn", "error"]
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /logs/statuses:
    get:
      tags: [Logs]
      summary: Log statuses
      operationId: listLogStatuses
      responses:
        '200':
          description: Statuses
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "1.90"
                    message: Log statuses retrieved successfully.
                    data:
                      statuses: ["SUCCESS", "FAILURE", "INFO"]
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
  /admin/users:
    get:
      tags: [Admin]
      summary: Admin list users
      operationId: adminListUsers
      description: Admin-only list with filtering and optional JSON body.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserListRequest'
            examples:
              listUsers:
                value:
                  limit: 20
                  sortBy: createdAt
                  order: desc
                  filterRole: user
      responses:
        '200':
          description: Users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.70"
                    message: Users retrieved successfully.
                    data:
                      users:
                        - id: 7
                          email: harry@hogwarts.edu
                          fullName: Harry Potter
                          preferredName: Harry
                          role: user
                          isVerified: true
                          isDisabled: false
                          lastLogin: "2025-02-03T18:10:05.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags: [Admin]
      summary: Admin create user
      operationId: adminCreateUser
      description: Create user as admin; can omit password to send setup email.
      x-rateLimit:
        limit: 60
        window: minute
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserCreate'
            examples:
              create:
                value:
                  fullName: Samwise Gamgee
                  preferredName: Sam
                  email: sam@shire.me
                  password: P@ssw0rd123!
                  role: user
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.91"
                    message: User created successfully.
                    data:
                      id: 12
                      email: sam@shire.me
                      fullName: Samwise Gamgee
                      preferredName: Sam
                      role: user
                      isVerified: false
                      isDisabled: false
                      passwordUpdated: "2025-02-05T09:00:00.000Z"
                      lastLogin: null
                      createdAt: "2025-02-05T09:00:00.000Z"
                      updatedAt: "2025-02-05T09:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/Conflict'
    put:
      tags: [Admin]
      summary: Admin update user (flexible)
      operationId: adminUpdateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserUpdateFlexible'
            examples:
              update:
                value:
                  id: 7
                  fullName: Harry James Potter
                  role: user
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.01"
                    message: User updated successfully.
                    data:
                      id: 7
                      email: harry@hogwarts.edu
                      fullName: Harry James Potter
                      preferredName: Harry
                      role: user
                      isVerified: true
                      isDisabled: false
                      updatedAt: "2025-02-05T10:21:44.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    delete:
      tags: [Admin]
      summary: Admin disable user (flexible)
      operationId: adminDeleteUser
      description: Soft-disable user by id or email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserDisableFlexible'
            examples:
              disable:
                value:
                  id: 12
      responses:
        '200':
          description: Disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.96"
                    message: User disabled successfully.
                    data:
                      id: 12
                      wasDisabled: true
                      revokedSessions: 2
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}:
    get:
      tags: [Admin]
      summary: Admin get user by id
      operationId: adminGetUserById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                nameOnly:
                  type: boolean
            examples:
              withNameOnly:
                value:
                  nameOnly: false
      responses:
        '200':
          description: User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.77"
                    message: User retrieved successfully.
                    data:
                      id: 7
                      email: harry@hogwarts.edu
                      fullName: Harry Potter
                      preferredName: Harry
                      role: user
                      isVerified: true
                      isDisabled: false
                      passwordUpdated: "2025-01-12T09:45:00.000Z"
                      lastLogin: "2025-02-03T18:10:05.000Z"
                      createdAt: "2025-01-12T09:30:00.000Z"
                      updatedAt: "2025-02-03T18:10:05.000Z"
                      oauthProviders:
                        - google
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    put:
      tags: [Admin]
      summary: Admin update user by id
      operationId: adminUpdateUserById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    delete:
      tags: [Admin]
      summary: Admin disable user by id
      operationId: adminDeleteUserById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/enable:
    post:
      tags: [Admin]
      summary: Enable user (flexible)
      operationId: adminEnableUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              enable:
                value:
                  email: user@example.com
      responses:
        '200':
          description: Enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User enabled successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/enable:
    post:
      tags: [Admin]
      summary: Enable user by id
      operationId: adminEnableUserById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
            examples:
              enableById:
                value: {}
      responses:
        '200':
          description: Enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User enabled successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/unverify:
    post:
      tags: [Admin]
      summary: Unverify user (flexible)
      operationId: adminUnverifyUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              unverify:
                value:
                  id: 12
      responses:
        '200':
          description: Unverified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User unverified successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/unverify:
    post:
      tags: [Admin]
      summary: Unverify user by id
      operationId: adminUnverifyUserById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Unverified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User unverified successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/verify:
    post:
      tags: [Admin]
      summary: Verify user (flexible)
      operationId: adminVerifyUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              verify:
                value:
                  email: user@example.com
      responses:
        '200':
          description: Verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User verified successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/verify:
    post:
      tags: [Admin]
      summary: Verify user by id
      operationId: adminVerifyUserById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.30"
                    message: User verified successfully.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/send-verification:
    post:
      tags: [Admin]
      summary: Send verification email (flexible)
      operationId: adminSendVerification
      x-rateLimit:
        limit: 1
        window: 5m
        note: adminEmailLimiter + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              send:
                value:
                  email: user@example.com
      responses:
        '200':
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.60"
                    message: Verification email sent.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/send-verification:
    post:
      tags: [Admin]
      summary: Send verification email by id
      operationId: adminSendVerificationById
      x-rateLimit:
        limit: 1
        window: 5m
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/reset-password:
    post:
      tags: [Admin]
      summary: Send password reset email (flexible)
      operationId: adminResetPassword
      x-rateLimit:
        limit: 1
        window: 5m
        note: adminEmailLimiter + emailCostLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              reset:
                value:
                  id: 12
      responses:
        '200':
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.60"
                    message: Password reset email sent.
                    data:
                      id: 12
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/reset-password:
    post:
      tags: [Admin]
      summary: Send password reset email by id
      operationId: adminResetPasswordById
      x-rateLimit:
        limit: 1
        window: 5m
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/sessions:
    post:
      tags: [Admin]
      summary: List sessions for user (flexible)
      operationId: adminListUserSessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              sessions:
                value:
                  email: user@example.com
      responses:
        '200':
          description: Sessions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.50"
                    message: Sessions retrieved successfully.
                    data:
                      sessions:
                        - fingerprint: session-abc123
                          issuedAt: "2025-02-04T10:00:00.000Z"
                          expiresAt: "2025-02-11T10:00:00.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/sessions:
    post:
      tags: [Admin]
      summary: List sessions for user by id
      operationId: adminListUserSessionsById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Sessions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/force-logout:
    post:
      tags: [Admin]
      summary: Force logout (flexible)
      operationId: adminForceLogout
      description: Revoke all sessions for a user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserActionFlexible'
            examples:
              logout:
                value:
                  id: 7
      responses:
        '200':
          description: Logged out
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.58"
                    message: Sessions revoked successfully.
                    data:
                      id: 7
                      revokedCount: 1
                      fingerprints:
                        - session-abc123
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/force-logout:
    post:
      tags: [Admin]
      summary: Force logout by id
      operationId: adminForceLogoutById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Logged out
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/handle-account-deletion:
    post:
      tags: [Admin]
      summary: Delete account permanently (flexible)
      operationId: adminHandleAccountDeletion
      x-rateLimit:
        limit: 60
        window: minute
        note: adminDeletionLimiter + sensitiveActionLimiter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminDeletionRequest'
            examples:
              delete:
                value:
                  id: 9
                  confirm: true
                  reason: Account deletion confirmed by user.
                  userToBeDeletedEmail: gollum@ring.me
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.88"
                    message: User account deleted permanently.
                    data:
                      id: 9
                      deletedCounts:
                        verification_tokens: 1
                        refresh_tokens: 2
                        oauth_accounts: 0
                        book_types: 2
                        authors: 0
                        publishers: 0
                        book_authors: 0
                        book_series: 0
                        book_series_books: 0
                        storage_locations: 1
                        books: 0
                        book_copies: 0
                        book_languages: 0
                        tags: 0
                        book_tags: 0
                      datesCleaned: 1
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/users/{id}/handle-account-deletion:
    post:
      tags: [Admin]
      summary: Delete account permanently by id
      operationId: adminHandleAccountDeletionById
      x-rateLimit:
        limit: 60
        window: minute
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminDeletionRequest'
            examples:
              deleteById:
                value:
                  confirm: true
                  reason: Account deletion confirmed by user.
                  userToBeDeletedEmail: gollum@ring.me
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "3.88"
                    message: User account deleted permanently.
                    data:
                      id: 9
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/languages:
    post:
      tags: [Admin, Languages]
      summary: Admin create language
      operationId: adminCreateLanguage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LanguageCreate'
            examples:
              create:
                value:
                  name: Zulu
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 201
                    responseTime: "3.10"
                    message: Language created successfully.
                    data:
                      id: 4
                      name: Zulu
                      createdAt: "2025-01-17T10:02:11.000Z"
                      updatedAt: "2025-01-17T10:02:11.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    put:
      tags: [Admin, Languages]
      summary: Admin update language
      operationId: adminUpdateLanguage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LanguageUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    delete:
      tags: [Admin, Languages]
      summary: Admin delete language
      operationId: adminDeleteLanguage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LanguageDelete'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /admin/languages/{id}:
    put:
      tags: [Admin, Languages]
      summary: Admin update language by id
      operationId: adminUpdateLanguageById
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LanguageUpdateById'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    delete:
      tags: [Admin, Languages]
      summary: Admin delete language by id
      operationId: adminDeleteLanguageById
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /status:
    get:
      tags: [Admin]
      summary: Admin status check
      operationId: getAdminStatus
      description: Check database and email queue health.
      responses:
        '200':
          description: Status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    status: success
                    httpCode: 200
                    responseTime: "2.12"
                    message: Status retrieved successfully.
                    data:
                      status: ok
                      db:
                        healthy: true
                        latencyMs: 7
                      emailQueue:
                        pending: 0
                        processing: 0
                        failed: 0
                        lastRunAt: "2026-01-02T16:00:10.000Z"
                    errors: []
        '401':
          $ref: '#/components/responses/AuthError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyHeader:
      type: apiKey
      in: header
      name: X-API-Key
    apiKeyAuthHeader:
      type: apiKey
      in: header
      name: Authorization
      description: Use value `ApiKey <apiKey>`.
  parameters:
    id:
      name: id
      in: path
      required: true
      schema:
        type: integer
      description: Numeric identifier.
    fingerprint:
      name: fingerprint
      in: path
      required: true
      schema:
        type: string
      description: Refresh token fingerprint.
  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 400
                responseTime: '2.10'
                message: Validation Error
                data: {}
                errors:
                  - Example validation message
    AuthError:
      description: Authentication required or invalid credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 401
                responseTime: '2.18'
                message: Authentication required for this action.
                data: {}
                errors:
                  - Missing or invalid Authorization header.
    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 403
                responseTime: '2.41'
                message: "Forbidden: Insufficient permissions."
                data: {}
                errors:
                  - You do not have permission to perform this action.
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 404
                responseTime: '2.84'
                message: Resource not found.
                data: {}
                errors:
                  - The requested resource could not be located.
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 409
                responseTime: '2.18'
                message: Conflict
                data: {}
                errors:
                  - Duplicate or conflicting record.
    RateLimit:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 429
                responseTime: '2.12'
                message: Too many requests
                data: {}
                errors:
                  - You have exceeded the maximum number of requests. Please try again later.
    ServerError:
      description: Server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            error:
              value:
                status: error
                httpCode: 500
                responseTime: '6.02'
                message: Internal Server Error
                data: {}
                errors:
                  - An unexpected error occurred while processing the request.
    DailyQuotaExceeded429:
      description: Daily quota exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          examples:
            quotaExceeded:
              value:
                status: error
                httpCode: 429
                responseTime: "2.20"
                message: Daily quota exceeded
                data: {}
                errors:
                  - You have reached the daily limit for this action. Please try again tomorrow.
  examples:
    authLoginRequest:
      summary: Login request
      value:
        captchaToken: "<captcha-token>"
        email: jane@example.com
        password: P@ssw0rd123!
    invalidTokenExample:
      summary: Invalid or expired token
      value:
        status: error
        httpCode: 400
        responseTime: "2.10"
        message: Invalid or expired token
        data: {}
        errors:
          - The confirmation token is invalid, has expired, or the supplied information does not match this request.
  schemas:
    ApiResponse:
      description: Standard response envelope used for every endpoint.
      type: object
      properties:
        status:
          description: Indicates success or error for the request.
          type: string
          enum: [success, error]
        httpCode:
          description: Mirrors the HTTP status code returned.
          type: integer
        responseTime:
          description: Duration in milliseconds (string formatted with two decimals).
          type: string
        message:
          description: Human-readable summary of the outcome.
          type: string
        data:
          description: Endpoint-specific payload object; empty object on errors unless noted.
          type: object
        errors:
          description: Array of human-readable error details; empty array on success.
          type: array
          items:
            type: string
      required: [status, httpCode, responseTime, message, data, errors]
    RateLimitStatus:
      description: Details about the current rate-limit bucket for the caller.
      type: object
      properties:
        limit:
          description: Maximum requests allowed in the window.
          type: integer
        remaining:
          description: Requests remaining before throttling.
          type: integer
        resetTime:
          description: Timestamp when the bucket resets.
          type: string
          format: date-time
    PartialDate:
      description: Partial date representation allowing missing day/month/year but requiring human-readable text.
      type: object
      properties:
        id:
          description: Internal identifier for the stored partial date.
          type: integer
        day:
          description: Day of month (1-31) or null when unknown.
          type:
            - integer
            - "null"
        month:
          description: Month (1-12) or null when unknown.
          type:
            - integer
            - "null"
        year:
          description: Year (1-9999) or null when unknown.
          type:
            - integer
            - "null"
        text:
          description: Human-readable date string matching the provided parts (e.g., \"29 July 1954\", \"October 2005\", \"2005\").
          type: string
      required: [text]
    User:
      description: Authenticated user profile; all resources are user-scoped unless admin.
      type: object
      properties:
        id:
          description: User identifier.
          type: integer
        email:
          description: Unique email address.
          type: string
        fullName:
          description: Full legal name.
          type: string
        preferredName:
          description: Optional friendly display name; may be null.
          type:
            - string
            - "null"
        role:
          description: Role for authorization checks.
          type: string
          enum: [user, admin]
        isVerified:
          description: Whether the email has been verified.
          type: boolean
        isDisabled:
          description: Soft-delete/disabled flag; disabled users cannot authenticate.
          type: boolean
        passwordUpdated:
          description: Timestamp of last password change; null for OAuth-only accounts.
          type:
            - string
            - "null"
          format: date-time
        lastLogin:
          description: Timestamp of the most recent successful login; null if never logged in.
          type:
            - string
            - "null"
          format: date-time
        createdAt:
          description: Creation timestamp.
          type: string
          format: date-time
        updatedAt:
          description: Last update timestamp.
          type: string
          format: date-time
        oauthProviders:
          description: Connected OAuth providers (e.g., google).
          type: array
          items:
            type: string
    Session:
      description: Refresh token fingerprint session metadata for a user.
      type: object
      properties:
        fingerprint:
          description: Unique refresh token fingerprint.
          type: string
        issuedAt:
          description: Time the refresh token was issued.
          type: string
          format: date-time
        expiresAt:
          description: Refresh token expiry time.
          type: string
          format: date-time
        ipAddress:
          description: IP address recorded for the session, if captured.
          type:
            - string
            - "null"
        userAgent:
          description: User agent string for the session, if captured.
          type:
            - string
            - "null"
    ApiKey:
      description: API key metadata; secrets are only shown on creation.
      type: object
      properties:
        id:
          description: Identifier for the API key.
          type: integer
        name:
          description: User-provided label for the key.
          type: string
        keyPrefix:
          description: Non-sensitive prefix to help identify the key.
          type: string
        lastUsedAt:
          description: Timestamp of last use; null if never used.
          type:
            - string
            - "null"
          format: date-time
        expiresAt:
          description: Expiry timestamp; null if non-expiring.
          type:
            - string
            - "null"
          format: date-time
        createdAt:
          description: Creation timestamp.
          type: string
          format: date-time
        revokedAt:
          description: Revocation timestamp; null if active.
          type:
            - string
            - "null"
          format: date-time
    ApiKeyCreated:
      description: Response payload when creating an API key; includes one-time secret.
      type: object
      properties:
        apiKey:
          $ref: '#/components/schemas/ApiKey'
        secret:
          description: Full API key secret value (only returned once).
          type: string
    RegisterRequest:
      description: Request payload to register a user with email/password and CAPTCHA.
      type: object
      required: [captchaToken, fullName, email, password]
      properties:
        captchaToken:
          type: string
        fullName:
          type: string
        preferredName:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
    LoginRequest:
      description: Request payload to authenticate via email/password with CAPTCHA.
      type: object
      required: [captchaToken, email, password]
      properties:
        captchaToken:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
    LoginResponseData:
      description: Tokens and user profile returned after authentication.
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/User'
    LogoutRequest:
      description: Revoke a refresh token or all sessions.
      type: object
      properties:
        refreshToken:
          type: string
        allDevices:
          oneOf:
            - type: boolean
            - type: string
    ResetPasswordRequest:
      description: Payload to reset password with emailed token and CAPTCHA.
      type: object
      required: [captchaToken, email, token, newPassword]
      properties:
        captchaToken:
          type: string
        email:
          type: string
          format: email
        token:
          type: string
        newPassword:
          type: string
    UpdateUserRequest:
      description: Updatable user profile fields for self-update.
      type: object
      properties:
        fullName:
          type: string
        preferredName:
          type:
            - string
            - "null"
    ChangePasswordRequest:
      description: Change password for the authenticated user.
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
    VerifyEmailChangeRequest:
      description: Confirm an email change using token, old/new email, password, and CAPTCHA. All errors for mismatched token/email/password/captcha are generic to prevent enumeration.
      type: object
      required: [token, oldEmail, newEmail, password, captchaToken]
      properties:
        token:
          description: Confirmation token from the email.
          type: string
        oldEmail:
          description: Current email address on the account.
          type: string
          format: email
        newEmail:
          description: New email address that was requested.
          type: string
          format: email
        password:
          description: Current account password for verification.
          type: string
        captchaToken:
          description: CAPTCHA token for action `verify_email_change`.
          type: string
    VerifyAccountDeletionRequest:
      description: Confirm permanent account deletion using token, email, password, explicit confirmation flag, and CAPTCHA. Invalid token/email/password/captcha return a generic invalid/expired token error.
      type: object
      required: [token, email, password, confirm, captchaToken]
      properties:
        token:
          description: Confirmation token from the deletion email.
          type: string
        email:
          description: Account email; must match the pending request.
          type: string
          format: email
        password:
          description: Current account password.
          type: string
        confirm:
          description: Must be true to confirm deletion.
          type: boolean
        captchaToken:
          description: CAPTCHA token for action `verify_account_deletion`.
          type: string
    BookType:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type:
            - string
            - "null"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        stats:
          description: Optional stats when returnStats is true.
          type: object
          properties:
            bookCount:
              type: integer
            percentageOfBooks:
              type: number
              format: float
            avgPageCount:
              type:
                - number
                - "null"
    BookTypeListRequest:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        nameOnly:
          type: boolean
        limit:
          type: integer
        offset:
          type: integer
        returnStats:
          type: boolean
        sortBy:
          type: string
        order:
          type: string
        filterId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single book type id or an array of ids.
        filterIdMode:
          type: string
          enum: [and, or]
          description: When multiple ids are provided, choose AND (default) or OR matching.
        filterName:
          type: string
        filterDescription:
          type: string
    BookTypeList:
      type: object
      properties:
        bookTypes:
          type: array
          items:
            $ref: '#/components/schemas/BookType'
    BookTypeCreate:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type:
            - string
            - "null"
    BookTypeUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type:
            - string
            - "null"
    BookTypeUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/BookTypeUpdate'
        - type: object
          properties:
            id:
              type: integer
            targetName:
              type: string
    BookTypeDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    BookTypeStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    BookTypeStatsResponse:
      type: object
      properties:
        stats:
          type: object
    Author:
      type: object
      properties:
        id:
          type: integer
        displayName:
          type: string
        firstNames:
          type:
            - string
            - "null"
        lastName:
          type:
            - string
            - "null"
        birthDate:
          $ref: '#/components/schemas/PartialDate'
        deceased:
          type: boolean
        deathDate:
          oneOf:
            - $ref: '#/components/schemas/PartialDate'
            - type: "null"
        bio:
          type:
            - string
            - "null"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        stats:
          description: Optional stats included when returnStats=true.
          type: object
          properties:
            bookCount:
              type: integer
            percentageOfBooks:
              type: number
              format: float
            firstPublicationYear:
              type:
                - integer
                - "null"
            lastPublicationYear:
              type:
                - integer
                - "null"
    AuthorListRequest:
      type: object
      properties:
        id:
          type: integer
        displayName:
          type: string
        nameOnly:
          type: boolean
        limit:
          type: integer
        offset:
          type: integer
        returnStats:
          type: boolean
        sortBy:
          type: string
        order:
          type: string
        filterId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single author id or an array of ids.
        filterIdMode:
          type: string
          enum: [and, or]
          description: When multiple ids are provided, choose AND (default) or OR matching.
        filterDisplayName:
          type: string
        filterFirstNames:
          type: string
        filterLastName:
          type: string
        filterDeceased:
          type: boolean
        filterBio:
          type: string
        filterBirthDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single birth date id or an array of ids.
        filterBirthDateMode:
          type: string
          enum: [and, or]
        filterDeathDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single death date id or an array of ids.
        filterDeathDateMode:
          type: string
          enum: [and, or]
    AuthorList:
      type: object
      properties:
        authors:
          type: array
          items:
            $ref: '#/components/schemas/Author'
    AuthorCreate:
      type: object
      required: [displayName]
      properties:
        displayName:
          type: string
        firstNames:
          type: string
        lastName:
          type: string
        birthDate:
          $ref: '#/components/schemas/PartialDate'
        deceased:
          type: boolean
        deathDate:
          $ref: '#/components/schemas/PartialDate'
        bio:
          type: string
    AuthorUpdate:
      type: object
      properties:
        displayName:
          type: string
        firstNames:
          type: string
        lastName:
          type: string
        birthDate:
          $ref: '#/components/schemas/PartialDate'
        deceased:
          type: boolean
        deathDate:
          $ref: '#/components/schemas/PartialDate'
        bio:
          type: string
    AuthorUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/AuthorUpdate'
        - type: object
          properties:
            id:
              type: integer
            displayName:
              type: string
    AuthorDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
        displayName:
          type: string
    AuthorStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    Publisher:
      description: Publisher record scoped to a user; supports soft delete.
      type: object
      properties:
        id:
          description: Publisher identifier.
          type: integer
        name:
          description: Publisher name (unique per user).
          type: string
        foundedDate:
          description: Partial founded date if known.
          $ref: '#/components/schemas/PartialDate'
        website:
          description: Publisher website URL if provided.
          type:
            - string
            - "null"
        notes:
          description: Additional notes about the publisher.
          type:
            - string
            - "null"
        createdAt:
          description: Creation timestamp.
          type: string
          format: date-time
        updatedAt:
          description: Last update timestamp.
          type: string
          format: date-time
        stats:
          description: Optional stats when returnStats is true.
          type: object
          properties:
            bookCount:
              type: integer
            percentageOfBooks:
              type: number
              format: float
            avgPageCount:
              type:
                - number
                - "null"
            firstPublicationYear:
              type:
                - integer
                - "null"
            lastPublicationYear:
              type:
                - integer
                - "null"
        deletedAt:
          description: Soft-delete timestamp when applicable.
          type:
            - string
            - "null"
          format: date-time
    PublisherListRequest:
      description: Filters and options for listing or fetching publishers; body overrides query params.
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        nameOnly:
          description: When true, return only id/name pairs.
          type: boolean
        includeDeleted:
          description: Include soft-deleted records when true.
          type: boolean
        limit:
          description: Page size (1-200).
          type: integer
        offset:
          description: Offset for pagination.
          type: integer
        returnStats:
          description: Include stats when a single record is returned.
          type: boolean
        sortBy:
          description: Sort field (id, name, website, notes, createdAt, updatedAt, foundedDateId, foundedDay, foundedMonth, foundedYear, foundedText).
          type: string
        order:
          description: Sort order, asc or desc.
          type: string
          enum: [asc, desc]
        filterId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single publisher id or an array of ids.
        filterIdMode:
          type: string
          enum: [and, or]
          description: When multiple publisher ids are provided, choose AND (default) or OR matching.
        filterName:
          type: string
        filterWebsite:
          type: string
        filterNotes:
          type: string
        filterFoundedDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single founded date id or an array of ids.
        filterFoundedDateMode:
          type: string
          enum: [and, or]
        filterFoundedDay:
          type: integer
        filterFoundedMonth:
          type: integer
        filterFoundedYear:
          type: integer
        filterFoundedText:
          type: string
        filterCreatedAt:
          type: string
        filterUpdatedAt:
          type: string
        filterCreatedAfter:
          type: string
        filterCreatedBefore:
          type: string
        filterUpdatedAfter:
          type: string
        filterUpdatedBefore:
          type: string
    BookList:
      description: Collection of books for list endpoints.
      type: object
      properties:
        books:
          type: array
          items:
            $ref: '#/components/schemas/Book'
        filterFoundedBefore:
          type: string
        filterFoundedAfter:
          type: string
    PublisherList:
      description: Collection of publishers in list responses.
      type: object
      properties:
        publishers:
          type: array
          items:
            $ref: '#/components/schemas/Publisher'
    PublisherCreate:
      description: Payload to create a publisher.
      type: object
      required: [name]
      properties:
        name:
          type: string
        foundedDate:
          $ref: '#/components/schemas/PartialDate'
        website:
          type: string
        notes:
          type: string
    PublisherUpdate:
      description: Updatable publisher fields.
      type: object
      properties:
        name:
          type: string
        foundedDate:
          $ref: '#/components/schemas/PartialDate'
        website:
          type: string
        notes:
          type: string
    PublisherUpdateFlexible:
      description: Update publisher by id or current name.
      allOf:
        - $ref: '#/components/schemas/PublisherUpdate'
        - type: object
          properties:
            id:
              type: integer
            targetName:
              type: string
    PublisherDeleteFlexible:
      description: Delete publisher by id or name.
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    PublisherStatsRequest:
      description: Selectable fields for publisher statistics.
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    Series:
      description: Book series owned by a user; supports soft delete and links to books.
      type: object
      properties:
        id:
          description: Series identifier.
          type: integer
        name:
          description: Series name (unique per user).
          type: string
        description:
          description: Optional description of the series.
          type:
            - string
            - "null"
        website:
          description: Optional series website.
          type:
            - string
            - "null"
        deletedAt:
          description: Deletion timestamp when soft-deleted.
          type:
            - string
            - "null"
        createdAt:
          description: Creation timestamp.
          type: string
        updatedAt:
          description: Last update timestamp.
          type: string
    SeriesListRequest:
      description: Filters and pagination for series; body overrides query params.
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        nameOnly:
          type: boolean
        includeDeleted:
          type: boolean
        limit:
          type: integer
        offset:
          type: integer
        returnStats:
          type: boolean
        sortBy:
          description: Sort field (id, name, description, website, createdAt, updatedAt, startDate*, endDate* variants).
          type: string
        order:
          type: string
          enum: [asc, desc]
        filterId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single series id or an array of ids.
        filterIdMode:
          type: string
          enum: [and, or]
          description: When multiple series ids are provided, choose AND (default) or OR matching.
        filterName:
          type: string
        filterDescription:
          type: string
        filterWebsite:
          type: string
        filterStartDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single start date id or an array of ids.
        filterStartDateMode:
          type: string
          enum: [and, or]
        filterStartDay:
          type: integer
        filterStartMonth:
          type: integer
        filterStartYear:
          type: integer
        filterStartText:
          type: string
        filterEndDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single end date id or an array of ids.
        filterEndDateMode:
          type: string
          enum: [and, or]
        filterEndDay:
          type: integer
        filterEndMonth:
          type: integer
        filterEndYear:
          type: integer
        filterEndText:
          type: string
        filterCreatedAt:
          type: string
        filterUpdatedAt:
          type: string
        filterCreatedAfter:
          type: string
        filterCreatedBefore:
          type: string
        filterUpdatedAfter:
          type: string
        filterUpdatedBefore:
          type: string
        filterStartedBefore:
          type: string
        filterStartedAfter:
          type: string
        filterEndedBefore:
          type: string
        filterEndedAfter:
          type: string
    SeriesList:
      description: Collection of series for list endpoints.
      type: object
      properties:
        series:
          type: array
          items:
            $ref: '#/components/schemas/Series'
    SeriesCreate:
      description: Payload to create a series.
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        website:
          type: string
    SeriesUpdate:
      description: Updatable series fields.
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        website:
          type: string
    SeriesUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/SeriesUpdate'
        - type: object
          properties:
            id:
              type: integer
            targetName:
              type: string
    SeriesDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    SeriesLinkRequest:
      type: object
      required: [seriesId, bookId]
      properties:
        seriesId:
          type: integer
        bookId:
          type: integer
        bookOrder:
          type: integer
    SeriesLinkDelete:
      type: object
      properties:
        seriesId:
          type: integer
        bookId:
          type: integer
    SeriesStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    Language:
      description: Language entry available to users; admin can create/update/delete globally.
      type: object
      properties:
        id:
          description: Language identifier.
          type: integer
        name:
          description: Language display name.
          type: string
        createdAt:
          type: string
        updatedAt:
          type: string
    LanguageCreate:
      description: Payload to create a language.
      type: object
      required: [name]
      properties:
        name:
          type: string
    LanguageUpdate:
      description: Payload to update a language by id.
      type: object
      required: [id, name]
      properties:
        id:
          type: integer
        name:
          type: string
    LanguageDelete:
      description: Payload to delete a language by id.
      type: object
      required: [id]
      properties:
        id:
          type: integer
    LanguageUpdateById:
      description: Update a language using the path id.
      type: object
      required: [name]
      properties:
        name:
          type: string
    Book:
      description: Book record owned by a user; soft deletes may hide entries from default queries.
      type: object
      properties:
        id:
          description: Book identifier.
          type: integer
        title:
          description: Primary title of the book.
          type: string
        subtitle:
          description: Optional subtitle.
          type:
            - string
            - "null"
        isbn:
          description: Normalized ISBN-10/13 without spaces/hyphens; may be null.
          type:
            - string
            - "null"
        publicationDate:
          description: Partial publication date.
          $ref: '#/components/schemas/PartialDate'
        pageCount:
          description: Number of pages; may be null if unknown.
          type:
            - integer
            - "null"
        coverImageUrl:
          description: Fully-qualified image URL.
          type:
            - string
            - "null"
        description:
          description: Free-text description or synopsis.
          type:
            - string
            - "null"
        bookTypeId:
          description: Related book type id when using card view.
          type:
            - integer
            - "null"
        publisherId:
          description: Related publisher id when using card view.
          type:
            - integer
            - "null"
        bookTypeName:
          description: Denormalized book type name when included in card view.
          type:
            - string
            - "null"
        bookType:
          description: Embedded book type details when requested.
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            description:
              type:
                - string
                - "null"
        languages:
          description: Languages attached to the book when included.
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
        tags:
          description: Tags attached to the book when included.
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
        publisher:
          description: Publisher details when included.
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            foundedDate:
              $ref: '#/components/schemas/PartialDate'
            website:
              type:
                - string
                - "null"
            notes:
              type:
                - string
                - "null"
        authors:
          description: Linked authors and their roles (included for view=all and view=card).
          type: array
          items:
            type: object
            properties:
              authorId:
                type: integer
              authorRole:
                type:
                  - string
                  - "null"
              authorName:
                type: string
              birthDate:
                $ref: '#/components/schemas/PartialDate'
              deathDate:
                $ref: '#/components/schemas/PartialDate'
              deceased:
                type:
                  - boolean
                  - "null"
              bio:
                type:
                  - string
                  - "null"
        series:
          description: Series membership when requested.
          type: array
          items:
            type: object
            properties:
              seriesId:
                type: integer
              seriesName:
                type: string
              bookOrder:
                type:
                  - integer
                  - "null"
        bookCopies:
          description: Copies of the book including storage info.
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              storageLocationId:
                type:
                  - integer
                  - "null"
              storageLocationPath:
                type:
                  - string
                  - "null"
              acquisitionStory:
                type:
                  - string
                  - "null"
              acquisitionDate:
                $ref: '#/components/schemas/PartialDate'
              acquiredFrom:
                type:
                  - string
                  - "null"
              acquisitionType:
                type:
                  - string
                  - "null"
              acquisitionLocation:
                type:
                  - string
                  - "null"
              notes:
                type:
                  - string
                  - "null"
              createdAt:
                type: string
              updatedAt:
                type: string
        stats:
          description: Aggregated stats for the book.
          type: object
          properties:
            copyCount:
              type: integer
            authorCount:
              type: integer
            tagCount:
              type: integer
            languageCount:
              type: integer
            seriesCount:
              type: integer
            hasIsbn:
              type: boolean
            hasPublicationDate:
              type: boolean
            hasCoverImage:
              type: boolean
            hasDescription:
              type: boolean
            hasPublisher:
              type: boolean
            hasBookType:
              type: boolean
            hasPageCount:
              type: boolean
        createdAt:
          description: Creation timestamp.
          type: string
        updatedAt:
          description: Last update timestamp.
          type: string
        deletedAt:
          description: Deletion timestamp when soft-deleted.
          type:
            - string
            - "null"
    BookListRequest:
      description: Filters and lookup options for listing or fetching books; body values take precedence over query params.
      type: object
      properties:
        id:
          type: integer
        isbn:
          type: string
        title:
          type: string
        view:
          type: string
          enum: [all, card, nameOnly]
          description: When set to card, responses include cover, tags, languages, and authors for fast card rendering.
        nameOnly:
          type: boolean
        includeDeleted:
          type: boolean
        limit:
          type: integer
        offset:
          type: integer
        returnStats:
          type: boolean
        sort:
          description: Array-based sort specification (each with field/order).
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              order:
                type: string
        sortBy:
          type: string
        order:
          type: string
        filterTitle:
          type: string
        filterSubtitle:
          type: string
        filterIsbn:
          type: string
        filterBookTypeId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single book type id or an array of ids.
        filterBookTypeMode:
          type: string
          enum: [and, or]
          description: When multiple book type ids are provided, choose AND (default) or OR matching.
        filterPublisherId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single publisher id or an array of ids.
        filterPublisherMode:
          type: string
          enum: [and, or]
          description: When multiple publisher ids are provided, choose AND (default) or OR matching.
        filterAuthorId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single author id or an array of ids.
        filterAuthorMode:
          type: string
          enum: [and, or]
          description: When multiple author ids are provided, choose AND (default) or OR matching.
        filterSeriesId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single series id or an array of ids.
        filterSeriesMode:
          type: string
          enum: [and, or]
          description: When multiple series ids are provided, choose AND (default) or OR matching.
        filterTag:
          oneOf:
            - type: string
            - type: array
              items: { type: string }
          description: Single tag name or an array of tag names.
        filterTagMode:
          type: string
          enum: [and, or]
          description: When multiple tags are provided, choose AND (default) or OR matching.
        filterLanguageId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single language id or an array of ids.
        filterLanguageIdMode:
          type: string
          enum: [and, or]
          description: When multiple language ids are provided, choose AND (default) or OR matching.
        filterLanguage:
          oneOf:
            - type: string
            - type: array
              items: { type: string }
          description: Single language name or an array of language names (normalized, case-insensitive).
        filterLanguageMode:
          type: string
          enum: [and, or]
          description: When multiple language names are provided, choose AND (default) or OR matching.
        filterPageMin:
          type: integer
          minimum: 0
        filterPageMax:
          type: integer
        filterPublishedBefore:
          type: string
        filterPublishedAfter:
          type: string
        filterPublishedYear:
          type: integer
        filterPublishedMonth:
          type: integer
        filterPublishedDay:
          type: integer
        filterCreatedAt:
          type: string
        filterUpdatedAt:
          type: string
        filterCreatedAfter:
          type: string
        filterCreatedBefore:
          type: string
        filterUpdatedAfter:
          type: string
        filterUpdatedBefore:
          type: string
    BookCreate:
      type: object
      required: [title]
      properties:
        title:
          type: string
        subtitle:
          type: string
        isbn:
          type: string
        publicationDate:
          $ref: '#/components/schemas/PartialDate'
        pageCount:
          type: integer
        coverImageUrl:
          type: string
        description:
          type: string
        bookTypeId:
          oneOf:
            - type: integer
            - type: array
              items:
                type: integer
        publisherId:
          oneOf:
            - type: integer
            - type: array
              items:
                type: integer
        authors:
          type: array
          items:
            oneOf:
              - type: integer
              - type: object
                properties:
                  authorId:
                    type: integer
                  authorRole:
                    type: string
        languageIds:
          type: array
          items:
            type: integer
        languageNames:
          type: array
          items:
            type: string
        tags:
          type: array
          items:
            type: string
        series:
          type: array
          items:
            oneOf:
              - type: integer
              - type: object
                properties:
                  seriesId:
                    type: integer
                  bookOrder:
                    type: integer
        bookCopy:
          $ref: '#/components/schemas/BookCopyCreate'
        bookCopies:
          type: array
          items:
            $ref: '#/components/schemas/BookCopyCreate'
        dryRun:
          type: boolean
    BookUpdate:
      allOf:
        - $ref: '#/components/schemas/BookCreate'
        - type: object
          properties:
            title:
              type: string
    BookUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/BookUpdate'
        - type: object
          properties:
            id:
              type: integer
            isbn:
              type: string
            targetTitle:
              type: string
    BookDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
        isbn:
          type: string
        title:
          type: string
    BookStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    StorageLocation:
      description: Storage container for book copies, supporting nesting and optional notes.
      type: object
      properties:
        id:
          description: Storage location identifier.
          type: integer
        name:
          description: Display name of the location.
          type: string
        parentId:
          description: Parent storage location id for nesting; null for root.
          type:
            - integer
            - "null"
        notes:
          description: Optional notes about the location.
          type:
            - string
            - "null"
        createdAt:
          type: string
        updatedAt:
          type: string
        path:
          description: Human-readable hierarchical path.
          type: string
    StorageLocationListRequest:
      description: Filters and pagination for storage locations.
      type: object
      properties:
        id:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single storage location id or an array of ids.
        filterIdMode:
          type: string
          enum: [and, or]
          description: When multiple ids are provided, choose AND (default) or OR matching.
        name:
          type: string
        parentId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single parent id or an array of ids.
        filterParentMode:
          type: string
          enum: [and, or]
          description: When multiple parent ids are provided, choose AND (default) or OR matching.
        limit:
          type: integer
        offset:
          type: integer
        includeNested:
          type: boolean
    StorageLocationCreate:
      description: Payload to create a storage location.
      type: object
      required: [name]
      properties:
        name:
          type: string
        parentId:
          type: integer
        notes:
          type: string
    StorageLocationUpdate:
      description: Updatable storage location fields.
      type: object
      properties:
        name:
          type: string
        parentId:
          type: integer
        notes:
          type: string
    StorageLocationUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/StorageLocationUpdate'
        - type: object
          properties:
            id:
              type: integer
            name:
              type: string
    StorageLocationDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    StorageLocationStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
    StorageLocationList:
      description: Collection of storage locations.
      type: object
      properties:
        storageLocations:
          type: array
          items:
            $ref: '#/components/schemas/StorageLocation'
    TimelineBucketsRequest:
      type: object
      properties:
        entity:
          type: string
          enum: [books, acquisitions]
        field:
          type: string
        start:
          type: string
          format: date
        end:
          type: string
          format: date
        step:
          type: integer
        stepUnit:
          type: string
          enum: [day, month, year]
        numberOfBuckets:
          type: integer
        auto:
          type: boolean
        hideEmptyBuckets:
          type: boolean
    TimelineBucketsResponse:
      type: object
      properties:
        entity:
          type: string
        field:
          type: string
        start:
          type: string
        end:
          type: string
        step:
          type: integer
        stepUnit:
          type: string
        numberOfBuckets:
          type: integer
        hideEmptyBuckets:
          type: boolean
        buckets:
          type: array
          items:
            type: object
            properties:
              start:
                type: string
              end:
                type: string
              label:
                type: string
              count:
                type: integer
        beforeStart:
          type: integer
        afterEnd:
          type: integer
        unknown:
          type: integer
    BookCopy:
      description: Individual copy of a book with acquisition and storage metadata.
      type: object
      properties:
        id:
          description: Copy identifier.
          type: integer
        bookId:
          description: Owning book id.
          type: integer
        storageLocationId:
          description: Storage location id; null when not assigned.
          type:
            - integer
            - "null"
        storageLocationPath:
          description: Human-readable storage path string.
          type:
            - string
            - "null"
        acquisitionStory:
          description: Free-text story about acquisition.
          type:
            - string
            - "null"
        acquisitionDate:
          description: Partial date of acquisition.
          $ref: '#/components/schemas/PartialDate'
        acquiredFrom:
          description: Who the copy was acquired from.
          type:
            - string
            - "null"
        acquisitionType:
          description: How the copy was obtained (e.g., Gift, Purchase).
          type:
            - string
            - "null"
        acquisitionLocation:
          description: Where the copy was obtained.
          type:
            - string
            - "null"
        notes:
          description: Additional notes about the copy.
          type:
            - string
            - "null"
        createdAt:
          description: Creation timestamp.
          type: string
        updatedAt:
          description: Last update timestamp.
          type: string
    BookCopyListRequest:
      type: object
      properties:
        id:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
        includeNested:
          type: boolean
        returnStats:
          type: boolean
        sortBy:
          type: string
        order:
          type: string
        filterBookId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single book id or an array of book ids.
        filterBookIdMode:
          type: string
          enum: [and, or]
          description: When multiple book ids are provided, choose AND (default) or OR matching.
        filterStorageLocationId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single storage location id or an array of ids.
        filterStorageLocationMode:
          type: string
          enum: [and, or]
          description: When multiple storage location ids are provided, choose AND (default) or OR matching.
        filterStorageLocationPath:
          type: string
        filterAcquisitionStory:
          type: string
        filterAcquiredFrom:
          type: string
        filterAcquisitionType:
          type: string
        filterAcquisitionLocation:
          type: string
        filterNotes:
          type: string
        filterAcquisitionDateId:
          oneOf:
            - type: integer
            - type: array
              items: { type: integer }
          description: Single acquisition date id or an array of ids.
        filterAcquisitionDateMode:
          type: string
          enum: [and, or]
          description: When multiple acquisition date ids are provided, choose AND (default) or OR matching.
        filterAcquisitionDay:
          type: integer
        filterAcquisitionMonth:
          type: integer
        filterAcquisitionYear:
          type: integer
        filterAcquisitionText:
          type: string
        filterAcquiredAfter:
          type: string
        filterAcquiredBefore:
          type: string
        filterCreatedAfter:
          type: string
        filterCreatedBefore:
          type: string
    BookCopyCreate:
      type: object
      properties:
        bookId:
          type: integer
        storageLocationId:
          type: integer
        storageLocationPath:
          type: string
        acquisitionStory:
          type: string
        acquisitionDate:
          $ref: '#/components/schemas/PartialDate'
        acquiredFrom:
          type: string
        acquisitionType:
          type: string
        acquisitionLocation:
          type: string
        notes:
          type: string
    BookCopyUpdate:
      type: object
      properties:
        storageLocationId:
          type: integer
        storageLocationPath:
          type: string
        acquisitionStory:
          type: string
        acquisitionDate:
          oneOf:
            - $ref: '#/components/schemas/PartialDate'
            - type: 'null'
        acquiredFrom:
          type: string
        acquisitionType:
          type: string
        acquisitionLocation:
          type: string
        notes:
          type: string
    BookCopyUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/BookCopyUpdate'
        - type: object
          properties:
            id:
              type: integer
    BookCopyDeleteFlexible:
      type: object
      properties:
        id:
          type: integer
    BookCopyStatsRequest:
      type: object
      properties:
        fields:
          type: array
          items:
            type: string
        breakdownLimit:
          type: integer
    BookCopyList:
      description: Collection of book copies.
      type: object
      properties:
        bookCopies:
          type: array
          items:
            $ref: '#/components/schemas/BookCopy'
    SearchRequest:
      description: Multi-entity search request body.
      type: object
      properties:
        query:
          description: Search string.
          type: string
        limit:
          description: Max results per entity.
          type: integer
        include:
          description: Entities to include in search.
          type: array
          items:
            type: string
            enum: [books, authors, publishers, series, tags]
    LogEntry:
      description: Structured user action or HTTP log entry.
      type: object
      properties:
        id:
          type: integer
        action:
          description: Log action code (e.g., LOGIN_ATTEMPT).
          type: string
        status:
          description: Normalized status (SUCCESS, FAILURE, INFO).
          type: string
        userId:
          description: Related user id when applicable.
          type:
            - integer
            - "null"
        metadata:
          description: Additional structured metadata.
          type: object
        createdAt:
          description: Timestamp of the log entry.
          type: string
          format: date-time
    LogListRequest:
      type: object
      properties:
        limit:
          type: integer
        offset:
          type: integer
        sortBy:
          type: string
        order:
          type: string
        filterAction:
          type: string
        filterStatus:
          type: string
        filterUserId:
          type: integer
        filterCreatedAfter:
          type: string
        filterCreatedBefore:
          type: string
    AdminUserListRequest:
      type: object
      properties:
        limit:
          type: integer
        offset:
          type: integer
        sortBy:
          type: string
        order:
          type: string
        filterEmail:
          type: string
        filterRole:
          type: string
        filterVerified:
          type: boolean
        filterDisabled:
          type: boolean
    AdminUserCreate:
      type: object
      required: [fullName, email]
      properties:
        fullName:
          type: string
        preferredName:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        noPassword:
          type: boolean
        duration:
          type: integer
        role:
          type: string
          enum: [user, admin]
    AdminUserUpdate:
      type: object
      properties:
        fullName:
          type: string
        preferredName:
          type:
            - string
            - "null"
        email:
          type: string
          format: email
        duration:
          type: integer
        role:
          type: string
          enum: [user, admin]
    AdminUserUpdateFlexible:
      allOf:
        - $ref: '#/components/schemas/AdminUserUpdate'
        - type: object
          properties:
            id:
              type: integer
            email:
              type: string
    AdminUserDisableFlexible:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
    AdminUserActionFlexible:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
    AdminDeletionRequest:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        confirm:
          type: boolean
        reason:
          type: string
        userToBeDeletedEmail:
          type: string
