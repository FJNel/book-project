<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
  <script>
    (function () {
      try {
        const pref = localStorage.getItem('themePreference');
        const resolved = (pref === 'light' || pref === 'dark')
          ? pref
          : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-bs-theme', resolved);
      } catch (e) {
        document.documentElement.setAttribute('data-bs-theme', 'light');
      }
    })();
  </script>
  <title>The Book Project - Account</title>
  <link rel="icon" type="image/png" sizes="500x499" href="assets/img/Icon.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/vendor/bootstrap-icons/bootstrap-icons.css" />
  <link rel="stylesheet" href="assets/css/Navbar-With-Button-icons.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <style>
    :root {
      --bp-radius: 12px;
      --bp-muted: var(--bs-secondary-color);
    }

    .account-section { display: none; }
    .account-section.active { display: block; }

    .page-header-title { letter-spacing: -0.01em; }
    .page-header-subtitle { color: var(--bp-muted); }

    .stats-nav .nav-link {
      border: 1px solid var(--bs-border-color);
      border-radius: 999px;
      font-weight: 600;
      color: var(--bs-body-color);
      background: var(--bs-body-bg);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      transition: color 0.15s ease, background-color 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
    }
    .stats-nav .nav-link:hover {
      color: var(--bs-primary);
      border-color: var(--bs-primary);
      background: var(--bs-tertiary-bg);
    }
    .stats-nav .nav-link:focus-visible { outline: none; box-shadow: var(--bs-focus-ring-box-shadow); }
    .stats-nav .nav-link.active {
      background: var(--bs-primary);
      border-color: var(--bs-primary);
      color: var(--bs-white);
      box-shadow: 0 10px 22px rgba(13, 110, 253, 0.2);
    }
    @media (max-width: 767.98px) {
      .stats-nav { flex-wrap: nowrap !important; overflow-x: auto; padding-bottom: 0.25rem; }
      .stats-nav .nav-link { white-space: nowrap; }
    }

    .account-card { border: 1px solid var(--bp-border); border-radius: var(--bp-radius); background: var(--bp-surface); box-shadow: var(--bp-shadow); }
    .muted-label { color: var(--bp-muted); font-size: 0.92rem; }
    .progress-sm { height: 10px; border-radius: 999px; background: var(--bp-soft); }
    .progress-sm .progress-bar { border-radius: 999px; }

    .stat-chip { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.35rem 0.75rem; border-radius: 999px; border: 1px solid var(--bp-border); background: var(--bp-soft); font-weight: 600; font-size: 0.9rem; }
    .stat-chip.is-action { cursor: pointer; }
    .stat-chip.is-action:focus-visible { outline: none; box-shadow: var(--bp-focus); }

    .stat-card { border: 1px solid var(--bp-border); border-radius: var(--bp-radius); padding: 1rem; background: linear-gradient(180deg, var(--bp-surface), var(--bp-soft)); box-shadow: var(--bp-shadow); min-height: 104px; display: flex; flex-direction: column; justify-content: center; gap: 0.35rem; transition: transform 0.12s ease, box-shadow 0.15s ease; }
    .stat-card.is-link { cursor: pointer; }
    .stat-card.is-link:hover { transform: translateY(-2px); box-shadow: 0 16px 34px rgba(0, 0, 0, 0.08); }
    .stat-card:focus-visible { outline: none; box-shadow: var(--bp-focus); }
    .stat-value { font-size: 1.5rem; font-weight: 700; }
    .stat-label { color: var(--bp-muted); font-weight: 600; font-size: 0.95rem; letter-spacing: -0.01em; }

    .detail-label { color: var(--bp-muted); font-size: 0.9rem; }
    .detail-value { font-weight: 600; word-break: break-word; }
    .detail-value.small-text { font-size: 0.95rem; }

    .table-sm td, .table-sm th { vertical-align: middle; }
    .table thead th { color: var(--bs-body-color); font-weight: 700; border-bottom-width: 1px; }
    .table-hover tbody tr:hover { background: var(--bs-tertiary-bg); }

    .empty-state { border: 1px dashed var(--bp-border); background: var(--bp-soft); border-radius: var(--bp-radius); padding: 1.25rem; }

    .device-icon { width: 18px; height: 18px; margin-right: 6px; }

    .danger-card { border: 1px solid var(--bp-danger-border); background: var(--bp-danger-surface); }
    .danger-soft { color: #b42318; }

    .focus-ring:focus-visible { outline: none; box-shadow: var(--bp-focus); }
  </style>
</head>
<body>
  <div id="navbarContainer"></div>

  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" id="pageLoadingModal">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-center">
          <h4 class="modal-title text-center">Page Loading</h4>
        </div>
        <div class="modal-body d-flex justify-content-center align-items-center">
          <div>
            <p class="text-center">Please wait while the page is loading...</p>
            <div class="d-flex justify-content-center"><span class="spinner-border" role="status"></span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" id="apiErrorModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">API Connection Error</h4>
        </div>
        <div class="modal-body">
          <h5>Unable to Connect</h5>
          <p>We're having trouble connecting to our services right now. The application cannot load the data it needs to function correctly.</p>
          <h5>What you can do</h5>
          <ul>
            <li><strong>Check your internet connection:</strong> Make sure you are connected to the internet.</li>
            <li><strong>Please try again in a few minutes:</strong> This may be a temporary issue.</li>
          </ul>
          <p class="mb-0"><em>If the problem continues, please contact the System Administrator at </em><a href="mailto:support@fjnel.co.za?subject=The%20Book%20Project%3A%20API%20Connection%20Error">support@fjnel.co.za</a></p>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" id="sessionExpiredModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Session Expired!</h4>
          <button class="btn-close" aria-label="Close" data-bs-dismiss="modal" type="button"></button>
        </div>
        <div class="modal-body">
          <p class="mb-0">Your session has ended for security reasons. This might happen due to:</p>
          <ul>
            <li><strong>Inactivity:</strong> You've been away for a while, and we need to confirm your access.</li>
            <li><strong>Password Reset:</strong> You changed your password recently, so you need to log in again on all devices.</li>
            <li><strong>Manual Logout:</strong> You manually logged out on all devices.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <main class="py-4">
    <div class="container">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-3">
        <div>
          <h1 class="h3 mb-1 page-header-title">Account</h1>
          <p class="text-muted mb-0 page-header-subtitle">Manage your profile, security, sessions, and account actions.</p>
        </div>
      </div>

      <div id="pageAlert" class="mb-3"></div>

      <ul class="nav nav-pills flex-column flex-md-row gap-2 mb-4 stats-nav" id="accountSectionNav">
        <li class="nav-item"><button class="nav-link active" type="button" data-section="overview" aria-current="page">Overview</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="profile" aria-current="false">Profile</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="security" aria-current="false">Security</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="email-preferences" aria-current="false">Email preferences</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="recycle" aria-current="false">Recycle bin</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="danger" aria-current="false">Danger zone</button></li>
      </ul>

      <section class="account-section active" data-section-content="overview">
        <div class="row g-3">
          <div class="col-12 col-lg-7">
            <div class="card account-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                  <div>
                    <div class="text-muted small">Welcome</div>
                    <h2 class="h4 mb-0" id="welcomeName">Loading…</h2>
                  </div>
                  <div class="d-flex flex-wrap gap-2" id="statusChips"></div>
                </div>
                <div class="mb-3">
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="muted-label">Profile completeness</span>
                    <span class="fw-semibold" id="profileScoreLabel">0%</span>
                  </div>
                  <div class="progress progress-sm">
                    <div class="progress-bar" id="profileScoreBar" role="progressbar" style="width: 0%"></div>
                  </div>
                  <div class="text-muted small mt-2" id="profileScoreHint">Keep your profile up to date for faster support.</div>
                  <div class="empty-state mt-3 d-none" id="profileChecklist">
                    <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-2">
                      <div>
                        <div class="fw-semibold">Complete your profile</div>
                        <div class="text-muted small" id="profileChecklistText">Add missing details to reach 100%.</div>
                      </div>
                      <button class="btn btn-primary btn-sm focus-ring" type="button" id="completeProfileBtn">Complete profile</button>
                    </div>
                    <ul class="mb-0 small" id="profileChecklistItems"></ul>
                  </div>
                </div>
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <div class="muted-label">Last login</div>
                    <div class="fw-semibold" id="overviewLastLogin">—</div>
                  </div>
                  <div class="col-12 col-md-6">
                    <div class="muted-label">Member since</div>
                    <div class="fw-semibold" id="overviewCreated">—</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-5">
            <div class="card account-card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h3 class="h6 mb-0">Library snapshot</h3>
                </div>
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3" id="statsTiles">
                  <div class="col"><div class="stat-card"><div class="stat-value">—</div><div class="stat-label">Loading…</div></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

                  <section class="account-section" data-section-content="profile">
                    <div class="card account-card shadow-sm mb-3">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <div>
                            <div class="text-muted small">Account details</div>
                            <h3 class="h5 mb-0">Profile</h3>
                          </div>
                          <button class="btn btn-primary d-inline-flex align-items-center gap-2" id="editProfileBtn" type="button">
                            <i class="bi bi-pencil-fill" aria-hidden="true"></i>
                            Edit profile
                          </button>
                        </div>
                        <div class="row g-3" id="profileDetails">
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Email</div>
                            <div class="detail-value text-break" id="profileEmail">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Preferred name</div>
                            <div class="detail-value" id="profilePreferred">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Full name</div>
                            <div class="detail-value" id="profileFull">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Last login</div>
                            <div class="detail-value small-text" id="profileLastLogin">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Created</div>
                            <div class="detail-value small-text" id="profileCreated">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Updated</div>
                            <div class="detail-value small-text" id="profileUpdated">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Role</div>
                            <div class="detail-value" id="profileRole">—</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="text-muted small">Appearance</div>
                        <h3 class="h5 mb-2">Theme</h3>
                        <p class="text-muted small">Choose how the interface looks. Device setting will follow your system appearance.</p>
                        <div class="mb-3" style="max-width: 360px;">
                          <label class="form-label" for="themePreferenceSelect">Theme</label>
                          <select class="form-select" id="themePreferenceSelect">
                            <option value="device">Use device setting</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                          </select>
                          <div class="form-text text-muted" id="themePreferenceHelp">Applied immediately after saving.</div>
                        </div>
                        <div class="small text-muted" id="themePreferenceChanges">No changes yet.</div>
                        <div class="d-flex gap-2 mt-3">
                          <button class="btn btn-outline-secondary" type="button" id="themePreferenceResetBtn">Reset</button>
                          <button class="btn btn-primary" type="button" id="themePreferenceSaveBtn" disabled>Save theme</button>
                        </div>
                        <div class="alert alert-danger d-none mt-3" id="themePreferenceError"></div>
                        <div class="alert alert-success d-none mt-3" id="themePreferenceSuccess"></div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="security">
                    <div class="row g-3 mb-3">
                      <div class="col-12 col-lg-6">
                        <div class="card account-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <div class="text-muted small">Password</div>
                              <h3 class="h5 mb-1">Password</h3>
                              <div class="text-muted small">Change your password to keep your account secure. Changing it will sign you out on other devices.</div>
                              <div class="text-muted small" id="passwordInfo">Loading…</div>
                              <div class="text-muted small" id="passwordLastChanged">Last changed: —</div>
                            </div>
                            <button class="btn btn-outline-primary d-inline-flex align-items-center gap-2 mt-auto align-self-start" id="changePasswordBtn" type="button">
                              <i class="bi bi-pencil-fill" aria-hidden="true"></i>
                              Change password
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <div class="text-muted small">Email</div>
                              <h3 class="h5 mb-1">Email</h3>
                              <div class="text-muted small">Request an email change. We will email a confirmation link to the new address.</div>
                              <div class="text-muted small" id="securityEmailCurrent">Current email: —</div>
                            </div>
                            <button class="btn btn-outline-primary d-inline-flex align-items-center gap-2 mt-auto align-self-start" id="changeEmailBtn" type="button">
                              <i class="bi bi-pencil-fill" aria-hidden="true"></i>
                              Request email change
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-2">
                          <div>
                            <div class="text-muted small">Active sessions</div>
                            <h3 class="h5 mb-1">Devices & sessions</h3>
                            <p class="text-muted small mb-0">Devices and sessions show where you’re signed in. Logging out will remove access on that device.</p>
                          </div>
                          <button class="btn btn-outline-danger d-inline-flex align-items-center gap-2" id="logoutAllBtn" type="button">
                            <i class="bi bi-slash-circle"></i>
                            Log out of all devices
                          </button>
                        </div>
                        <div class="table-responsive">
                          <table class="table table-sm table-hover align-middle" id="sessionsTable">
                            <thead>
                              <tr>
                                <th>Device</th>
                                <th>Issued</th>
                                <th>Location / IP</th>
                                <th>Expires</th>
                                <th class="text-end"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr><td colspan="5" class="text-muted">Loading sessions…</td></tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="email-preferences">
                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="text-muted small">Notifications</div>
                        <h3 class="h5 mb-2">Email preferences</h3>
                        <p class="text-muted small">Choose which non-essential emails you would like to receive.</p>

                        <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" id="emailPrefEssential" checked disabled>
                          <label class="form-check-label" for="emailPrefEssential">Essential account emails (required)</label>
                          <div class="form-text text-muted">Security and access emails are always sent.</div>
                        </div>

                        <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" id="emailPrefAccountUpdates">
                          <label class="form-check-label" for="emailPrefAccountUpdates">Account updates</label>
                          <div class="form-text text-muted" id="emailPrefAccountHelp">Updates about changes to your account.</div>
                        </div>

                        <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" id="emailPrefDevFeatures">
                          <label class="form-check-label" for="emailPrefDevFeatures">Development and features</label>
                          <div class="form-text text-muted" id="emailPrefDevHelp">Optional updates about new features and notes.</div>
                        </div>

                        <div class="small text-muted" id="emailPrefChanges">No changes yet.</div>
                        <div class="d-flex gap-2 mt-3">
                          <button class="btn btn-outline-secondary" type="button" id="emailPrefResetBtn">Reset</button>
                          <button class="btn btn-primary" type="button" id="emailPrefSaveBtn" disabled>Save preferences</button>
                        </div>
                        <div class="alert alert-danger d-none mt-3" id="emailPrefError"></div>
                        <div class="alert alert-success d-none mt-3" id="emailPrefSuccess"></div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="recycle">
                    <div class="card account-card shadow-sm mb-3">
                      <div class="card-body">
                        <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
                          <div>
                            <div class="text-muted small">Recycle bin</div>
                            <h3 class="h5 mb-1">Deleted items</h3>
                            <p class="text-muted small mb-0">Restore items or delete them permanently. Restoring may require conflict handling.</p>
                          </div>
                          <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-secondary btn-sm" type="button" id="recycleRefreshBtn">Refresh</button>
                            <button class="btn btn-success btn-sm" type="button" id="recycleRestoreBtn" disabled>Restore selected</button>
                            <button class="btn btn-danger btn-sm" type="button" id="recycleDeleteBtn" disabled>Delete permanently</button>
                          </div>
                        </div>

                        <div class="alert alert-danger d-none" id="recycleError"></div>

                        <div class="d-flex flex-wrap gap-3 mb-3">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="recycleFilterBooks" checked>
                            <label class="form-check-label" for="recycleFilterBooks">Books</label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="recycleFilterAuthors" checked>
                            <label class="form-check-label" for="recycleFilterAuthors">Authors</label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="recycleFilterPublishers" checked>
                            <label class="form-check-label" for="recycleFilterPublishers">Publishers</label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="recycleFilterSeries" checked>
                            <label class="form-check-label" for="recycleFilterSeries">Series</label>
                          </div>
                        </div>

                        <div class="table-responsive">
                          <table class="table table-sm table-hover align-middle" id="recycleTable">
                            <thead>
                              <tr>
                                <th style="width: 40px;">
                                  <input class="form-check-input" type="checkbox" id="recycleSelectAll" aria-label="Select all deleted items">
                                </th>
                                <th>Type</th>
                                <th>Name</th>
                                <th>Deleted</th>
                                <th class="text-end">Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr><td colspan="5" class="text-muted">Loading deleted items…</td></tr>
                            </tbody>
                          </table>
                        </div>

                        <div class="empty-state d-none" id="recycleEmptyState">
                          <div class="fw-semibold mb-1">Recycle bin is empty</div>
                          <div class="text-muted small">Deleted books, authors, publishers, and series will appear here.</div>
                        </div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="danger">
                    <div class="row g-3 mb-3">
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <h3 class="h5 mb-1 text-danger">Request account disable</h3>
                              <p class="text-muted small mb-0">Temporarily disable your account. We’ll email you a confirmation link. Once confirmed, you’ll be signed out everywhere and cannot log back in until support re-enables your account. To re-enable later, contact <a href="mailto:support@fjnel.co.za">support@fjnel.co.za</a>.</p>
                            </div>
                            <button class="btn btn-primary d-inline-flex align-items-center gap-2" id="disableAccountBtn" type="button">
                              <i class="bi bi-person-x-fill"></i>
                              Request account disable
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <h3 class="h5 mb-1 text-danger">Request account deletion</h3>
                              <p class="text-muted small mb-0">Start the deletion process. You’ll receive a confirmation email. After confirmation, support will permanently delete your account and library data.</p>
                            </div>
                            <button class="btn btn-danger d-inline-flex align-items-center gap-2" id="deleteAccountBtn" type="button">
                              <i class="bi bi-trash-fill"></i>
                              Request account deletion
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
                          <div>
                            <div class="text-muted small">Programmatic access</div>
                            <h3 class="h5 mb-1">API keys</h3>
                            <p class="text-muted small mb-0">API keys allow programmatic access to your library via the API. Only create keys if you know what you’re doing. Usage is monitored by the administrator and keys may be revoked to protect the Book Project. Keep them secret and rotate regularly. See <a href="https://api.fjnel.co.za/docs" target="_blank" rel="noreferrer">API docs</a>.</p>
                          </div>
                          <button class="btn btn-outline-primary js-create-api-key" id="createApiKeyBtn" type="button">Create API key</button>
                        </div>
                        <div class="empty-state d-none" id="apiKeysEmpty">
                          <div class="fw-semibold mb-1">No API keys yet</div>
                          <p class="text-muted small mb-3">Create an API key to integrate The Book Project with other tools or scripts. Only create keys if you need them; admins monitor usage and may revoke keys to protect the Book Project.</p>
                          <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary btn-sm js-create-api-key" type="button" data-create-api-key>Create API key</button>
                            <a class="btn btn-link btn-sm" href="https://api.fjnel.co.za/docs" target="_blank" rel="noreferrer">Read API docs</a>
                          </div>
                        </div>
                        <div class="table-responsive">
                          <table class="table table-sm table-hover align-middle" id="apiKeysTable">
                            <thead>
                              <tr>
                                <th>Name</th>
                                <th>Prefix</th>
                                <th>Created</th>
                                <th>Expires</th>
                                <th>Last used</th>
                                <th>Status</th>
                                <th class="text-end"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr><td colspan="7" class="text-muted">Loading API keys…</td></tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </section>
        </div>
      </div>
    </div>
  </main>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger d-none" id="editProfileError"></div>
          <div class="mb-3">
            <label class="form-label" for="editFullName">Full name</label>
            <input class="form-control" id="editFullName" type="text" maxlength="255" />
            <small class="form-text text-muted" id="editFullNameHelp"></small>
          </div>
          <div class="mb-0">
            <label class="form-label" for="editPreferredName">Preferred name</label>
            <input class="form-control" id="editPreferredName" type="text" maxlength="100" />
            <small class="form-text text-muted" id="editPreferredNameHelp"></small>
          </div>
          <div class="small text-muted mt-3" id="editProfileChanges" aria-live="polite">No changes yet.</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" id="editProfileResetBtn">Revert</button>
          <button class="btn btn-primary" type="button" id="editProfileSaveBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Change password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger d-none" id="changePasswordError"></div>
          <div class="mb-3">
            <label class="form-label" for="currentPassword">Current password</label>
            <input class="form-control" id="currentPassword" type="password" autocomplete="current-password" />
            <small class="form-text text-muted" id="currentPasswordHelp"></small>
          </div>
          <div class="mb-3">
            <label class="form-label" for="newPassword">New password</label>
            <input class="form-control" id="newPassword" type="password" autocomplete="new-password" />
            <small class="form-text text-muted" id="newPasswordHelp"></small>
          </div>
          <div class="mb-0">
            <label class="form-label" for="confirmNewPassword">Confirm new password</label>
            <input class="form-control" id="confirmNewPassword" type="password" autocomplete="new-password" />
            <small class="form-text text-muted" id="confirmNewPasswordHelp"></small>
          </div>
          <div class="small text-muted mt-3" id="changePasswordChanges" aria-live="polite">No changes yet.</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="button" id="changePasswordSaveBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Update password</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Email Modal -->
  <div class="modal fade" id="changeEmailModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request email change</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-success d-none" id="changeEmailSuccess">If this email can be used, you will receive a confirmation link shortly.</div>
          <div class="alert alert-danger d-none" id="changeEmailError"></div>
          <div class="mb-0">
            <label class="form-label" for="newEmail">New email address</label>
            <input class="form-control" id="newEmail" type="email" autocomplete="email" />
            <small class="form-text text-muted" id="changeEmailHelp">We will send a confirmation email to the new address. This may sign you out of all devices once confirmed.</small>
          </div>
          <div class="small text-muted mt-3" id="changeEmailChanges" aria-live="polite">No changes yet.</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="button" id="changeEmailSaveBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send request</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Revoke Session Modal -->
  <div class="modal fade" id="revokeSessionModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log out of this device</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">You will be logged out on this device. You can log back in anytime.</p>
          <div class="text-muted small" id="revokeSessionDetail"></div>
          <div class="alert alert-danger d-none mt-3" id="revokeSessionError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmRevokeSessionBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Log out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Out All Modal -->
  <div class="modal fade" id="logoutAllModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log out of all devices</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">This signs you out everywhere. Active refresh tokens will be invalidated.</p>
          <div class="alert alert-danger d-none" id="logoutAllError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmLogoutAllBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Log out everywhere</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create API Key Modal -->
  <div class="modal fade" id="createApiKeyModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create API key</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-success d-none" id="apiKeySecretWrap">
            <div class="fw-semibold mb-1">Copy this secret now</div>
            <div class="api-secret-box mb-2" id="apiKeySecret"></div>
            <button class="btn btn-outline-primary btn-sm" type="button" id="copyApiKeySecretBtn">Copy secret</button>
            <div class="text-muted small mt-2">You will not be able to view this secret again.</div>
          </div>
          <div class="alert alert-danger d-none" id="createApiKeyError"></div>
          <div class="mb-3">
            <label class="form-label" for="apiKeyName">Name</label>
            <input class="form-control" id="apiKeyName" type="text" maxlength="120" />
            <small class="form-text text-muted">Provide a name to identify this key.</small>
          </div>
          <div class="mb-0">
            <label class="form-label" for="apiKeyExpiresAt">Expires at (optional)</label>
            <input class="form-control" id="apiKeyExpiresAt" type="datetime-local" />
            <small class="form-text text-muted">Leave blank for no expiry.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" type="button" id="createApiKeySaveBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Revoke API Key Modal -->
  <div class="modal fade" id="revokeApiKeyModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Revoke API key</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">Revoke this API key? This cannot be undone.</p>
          <div class="text-muted small" id="revokeApiKeyDetail"></div>
          <div class="alert alert-danger d-none mt-3" id="revokeApiKeyError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmRevokeApiKeyBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Revoke</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Disable Account Modal -->
  <div class="modal fade" id="disableAccountModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Disable account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">We will email you a confirmation link. After you confirm, you will be signed out everywhere and will not be able to log back in until support re-enables your account.</p>
          <p class="text-muted small mb-3">Need to re-enable? Contact <a href="mailto:support@fjnel.co.za">support@fjnel.co.za</a>.</p>
          <div class="alert alert-danger d-none" id="disableAccountError"></div>
        </div>
        <div class="modal-footer justify-content-start">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="button" id="confirmDisableAccountBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send email</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request account deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">We will email you a confirmation link. After you confirm, support will permanently delete your account and library data.</p>
          <p class="text-muted small mb-3">Type <strong>DELETE</strong> to continue.</p>
          <input class="form-control mb-2" id="deleteAccountConfirmInput" type="text" autocomplete="off" placeholder="Type DELETE to confirm" />
          <small class="form-text text-muted" id="deleteAccountHelp">Type DELETE to enable the request.</small>
          <div class="alert alert-danger d-none" id="deleteAccountError"></div>
        </div>
        <div class="modal-footer justify-content-start">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmDeleteAccountBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send request</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="recycleRestoreModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Restore deleted items</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2" id="recycleRestoreSummary">Restore selected items to your library.</p>
          <div class="mb-3">
            <label class="form-label" for="recycleRestoreMode"><strong>Conflict handling</strong></label>
            <select class="form-select" id="recycleRestoreMode">
              <option value="decline">Decline if another item matches</option>
              <option value="merge">Merge into the existing item</option>
              <option value="override">Override the existing item</option>
            </select>
            <small class="form-text text-muted" id="recycleRestoreModeHelp">Decline leaves items deleted if a conflict is found.</small>
          </div>
          <div class="alert alert-danger d-none" id="recycleRestoreError"></div>
          <div class="small text-muted" id="recycleRestoreChanges">No changes yet.</div>
        </div>
        <div class="modal-footer justify-content-start">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-success" type="button" id="recycleRestoreConfirmBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Restore</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="recycleDeleteModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete items permanently</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2" id="recycleDeleteSummary">These items will be permanently deleted from your library.</p>
          <p class="text-muted small mb-2">Type <strong>DELETE</strong> to continue.</p>
          <input class="form-control mb-2" id="recycleDeleteConfirmInput" type="text" autocomplete="off" placeholder="Type DELETE to confirm" />
          <small class="form-text text-muted" id="recycleDeleteHelp">Type DELETE to enable permanent deletion.</small>
          <div class="alert alert-danger d-none" id="recycleDeleteError"></div>
        </div>
        <div class="modal-footer justify-content-start">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="recycleDeleteConfirmBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Delete permanently</button>
        </div>
      </div>
    </div>
  </div>

  <div id="recaptcha-root" class="hidden" data-sitekey="6LeedsorAAAAALv_xUltcVyeYvCInfhGVl7qkeMA"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/http-interceptor.js"></script>
  <script src="assets/js/common.js"></script>
  <script src="assets/js/navbar.js"></script>
  <script src="assets/js/maintenance.js"></script>
  <script src="assets/js/recaptcha-v3.js"></script>
  <script src="assets/js/account.js"></script>
</body>
</html>
