<!DOCTYPE html>
<html data-bs-theme="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
  <title>The Book Project - Account</title>
  <link rel="icon" type="image/png" sizes="500x499" href="assets/img/Icon.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/Navbar-With-Button-icons.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <style>
    :root {
      --bp-surface: #fff;
      --bp-soft: #f8f9fb;
      --bp-border: rgba(0, 0, 0, 0.07);
      --bp-radius: 14px;
      --bp-shadow: 0 12px 32px rgba(0, 0, 0, 0.06);
      --bp-muted: #6c757d;
      --bp-focus: 0 0 0 0.15rem rgba(13, 110, 253, 0.35);
    }

    .account-section { display: none; }
    .account-section.active { display: block; }

    .page-header-title { letter-spacing: -0.01em; }
    .page-header-subtitle { color: var(--bp-muted); }

    .stats-nav .nav-link {
      border: 1px solid var(--bp-border);
      border-radius: 999px;
      font-weight: 600;
      color: #334155;
      background: var(--bp-surface);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.04);
      transition: all 0.15s ease;
    }
    .stats-nav .nav-link:hover { color: #0d6efd; border-color: #0d6efd33; }
    .stats-nav .nav-link:focus-visible { outline: none; box-shadow: var(--bp-focus); }
    .stats-nav .nav-link.active {
      background: linear-gradient(135deg, #0d6efd, #0b5ed7);
      border-color: transparent;
      color: #fff;
      box-shadow: 0 12px 26px rgba(13, 110, 253, 0.26);
    }
    @media (max-width: 767.98px) {
      .stats-nav { flex-wrap: nowrap !important; overflow-x: auto; padding-bottom: 0.25rem; }
      .stats-nav .nav-link { white-space: nowrap; }
    }

    .account-card { border: 1px solid var(--bp-border); border-radius: var(--bp-radius); background: var(--bp-surface); box-shadow: var(--bp-shadow); }
    .muted-label { color: var(--bp-muted); font-size: 0.92rem; }
    .progress-sm { height: 10px; border-radius: 999px; background: var(--bp-soft); }
    .progress-sm .progress-bar { border-radius: 999px; }

    .stat-chip { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.35rem 0.75rem; border-radius: 999px; border: 1px solid var(--bp-border); background: var(--bp-soft); font-weight: 600; font-size: 0.9rem; }

    .stat-card { border: 1px solid var(--bp-border); border-radius: var(--bp-radius); padding: 1rem; background: linear-gradient(180deg, #fff, #f9fbff); box-shadow: var(--bp-shadow); min-height: 104px; display: flex; flex-direction: column; justify-content: center; gap: 0.35rem; transition: transform 0.12s ease, box-shadow 0.15s ease; }
    .stat-card.is-link { cursor: pointer; }
    .stat-card.is-link:hover { transform: translateY(-2px); box-shadow: 0 16px 34px rgba(0, 0, 0, 0.08); }
    .stat-card:focus-visible { outline: none; box-shadow: var(--bp-focus); }
    .stat-value { font-size: 1.5rem; font-weight: 700; }
    .stat-label { color: var(--bp-muted); font-weight: 600; font-size: 0.95rem; letter-spacing: -0.01em; }

    .detail-label { color: var(--bp-muted); font-size: 0.9rem; }
    .detail-value { font-weight: 600; word-break: break-word; }
    .detail-value.small-text { font-size: 0.95rem; }

    .table-sm td, .table-sm th { vertical-align: middle; }
    .table thead th { color: #334155; font-weight: 700; border-bottom-width: 1px; }
    .table-hover tbody tr:hover { background: #f8fafc; }

    .empty-state { border: 1px dashed var(--bp-border); background: var(--bp-soft); border-radius: var(--bp-radius); padding: 1.25rem; }

    .device-icon { width: 18px; height: 18px; margin-right: 6px; }

    .danger-card { border: 1px solid rgba(220, 53, 69, 0.18); background: #fff5f5; }
    .danger-soft { color: #b42318; }

    .focus-ring:focus-visible { outline: none; box-shadow: var(--bp-focus); }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="dashboard">The Book Project</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="dashboard">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="books">Books</a></li>
          <li class="nav-item"><a class="nav-link" href="publishers">Publishers</a></li>
          <li class="nav-item"><a class="nav-link" href="authors">Authors</a></li>
          <li class="nav-item"><a class="nav-link" href="series">Series</a></li>
          <li class="nav-item"><a class="nav-link" href="storage-locations">Storage Locations</a></li>
          <li class="nav-item"><a class="nav-link" href="statistics">Statistics</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="account">Account</a></li>
        </ul>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-danger btn-sm js-logout-btn" type="button">Log out</button>
        </div>
      </div>
    </div>
  </nav>

  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" id="pageLoadingModal">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-center">
          <h4 class="modal-title text-center">Page Loading</h4>
        </div>
        <div class="modal-body d-flex justify-content-center align-items-center">
          <div>
            <p class="text-center">Please wait while the page is loading...</p>
            <div class="d-flex justify-content-center"><span class="spinner-border" role="status"></span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" id="apiErrorModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">API Connection Error</h4>
        </div>
        <div class="modal-body">
          <h5>Unable to Connect</h5>
          <p>We're having trouble connecting to our services right now. The application cannot load the data it needs to function correctly.</p>
          <h5>What you can do</h5>
          <ul>
            <li><strong>Check your internet connection:</strong> Make sure you are connected to the internet.</li>
            <li><strong>Please try again in a few minutes:</strong> This may be a temporary issue.</li>
          </ul>
          <p class="mb-0"><em>If the problem continues, please contact the System Administrator at </em><a href="mailto:support@fjnel.co.za?subject=The%20Book%20Project%3A%20API%20Connection%20Error">support@fjnel.co.za</a></p>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" role="dialog" tabindex="-1" data-bs-backdrop="static" id="sessionExpiredModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Session Expired!</h4>
          <button class="btn-close" aria-label="Close" data-bs-dismiss="modal" type="button"></button>
        </div>
        <div class="modal-body">
          <p class="mb-0">Your session has ended for security reasons. This might happen due to:</p>
          <ul>
            <li><strong>Inactivity:</strong> You've been away for a while, and we need to confirm your identity.</li>
            <li><strong>Password Reset:</strong> You changed your password recently, so you need to log in again on all devices.</li>
            <li><strong>Manual Logout:</strong> You manually logged out on all devices.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <main class="py-4">
    <div class="container">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-3">
        <div>
          <h1 class="h3 mb-1 page-header-title">Account</h1>
          <p class="text-muted mb-0 page-header-subtitle">Manage your profile, security, sessions, and account actions.</p>
        </div>
      </div>

      <ul class="nav nav-pills flex-column flex-md-row gap-2 mb-4 stats-nav" id="accountSectionNav">
        <li class="nav-item"><button class="nav-link active" type="button" data-section="overview" aria-current="page">Overview</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="profile" aria-current="false">Profile</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="security" aria-current="false">Security</button></li>
        <li class="nav-item"><button class="nav-link" type="button" data-section="danger" aria-current="false">Danger zone</button></li>
      </ul>

      <section class="account-section active" data-section-content="overview">
        <div class="row g-3">
          <div class="col-12 col-lg-7">
            <div class="card account-card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                  <div>
                    <div class="text-muted small">Welcome</div>
                    <h2 class="h4 mb-0" id="welcomeName">Loading…</h2>
                  </div>
                  <div class="d-flex flex-wrap gap-2" id="statusChips"></div>
                </div>
                <div class="mb-3">
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="muted-label">Profile completeness</span>
                    <span class="fw-semibold" id="profileScoreLabel">0%</span>
                  </div>
                  <div class="progress progress-sm">
                    <div class="progress-bar" id="profileScoreBar" role="progressbar" style="width: 0%"></div>
                  </div>
                  <div class="text-muted small mt-2" id="profileScoreHint">Keep your profile up to date for faster support.</div>
                  <div class="empty-state mt-3 d-none" id="profileChecklist">
                    <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-2">
                      <div>
                        <div class="fw-semibold">Complete your profile</div>
                        <div class="text-muted small" id="profileChecklistText">Add missing details to reach 100%.</div>
                      </div>
                      <button class="btn btn-primary btn-sm focus-ring" type="button" id="completeProfileBtn">Complete profile</button>
                    </div>
                    <ul class="mb-0 small" id="profileChecklistItems"></ul>
                  </div>
                </div>
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <div class="muted-label">Last login</div>
                    <div class="fw-semibold" id="overviewLastLogin">—</div>
                  </div>
                  <div class="col-12 col-md-6">
                    <div class="muted-label">Member since</div>
                    <div class="fw-semibold" id="overviewCreated">—</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-5">
            <div class="card account-card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h3 class="h6 mb-0">Library snapshot</h3>
                </div>
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3" id="statsTiles">
                  <div class="col"><div class="stat-card"><div class="stat-value">—</div><div class="stat-label">Loading…</div></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

                  <section class="account-section" data-section-content="profile">
                    <div class="card account-card shadow-sm mb-3">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <div>
                            <div class="text-muted small">Account details</div>
                            <h3 class="h5 mb-0">Profile</h3>
                          </div>
                          <button class="btn btn-outline-primary d-inline-flex align-items-center gap-2" id="editProfileBtn" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                              <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293z"/>
                              <path d="M13.752 4.396 11.604 2.248 4.939 8.913a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.518z"/>
                              <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                            </svg>
                            Edit profile
                          </button>
                        </div>
                        <div class="row g-3" id="profileDetails">
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Email</div>
                            <div class="detail-value text-break" id="profileEmail">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Preferred name</div>
                            <div class="detail-value" id="profilePreferred">—</div>
                            <div class="text-muted small">Used for greetings.</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Full name</div>
                            <div class="detail-value" id="profileFull">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Last login</div>
                            <div class="detail-value small-text" id="profileLastLogin">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Created</div>
                            <div class="detail-value small-text" id="profileCreated">—</div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="detail-label">Updated</div>
                            <div class="detail-value small-text" id="profileUpdated">—</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="security">
                    <div class="row g-3 mb-3">
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <div class="text-muted small">Password</div>
                              <h3 class="h5 mb-1">Password</h3>
                              <div class="text-muted small">Changing your password signs you out on other devices.</div>
                              <div class="text-muted small" id="passwordInfo">Loading…</div>
                            </div>
                            <button class="btn btn-primary d-inline-flex align-items-center gap-2" id="changePasswordBtn" type="button">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293z"/>
                                <path d="M13.752 4.396 11.604 2.248 4.939 8.913a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.518z"/>
                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                              </svg>
                              Change password
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <div class="text-muted small">Email</div>
                              <h3 class="h5 mb-1">Email</h3>
                              <div class="text-muted small">Request an email change; we will send a confirmation link to the new address.</div>
                            </div>
                            <button class="btn btn-outline-primary d-inline-flex align-items-center gap-2" id="changeEmailBtn" type="button">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-arrow-down-fill" viewBox="0 0 16 16">
                                <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zm.192 8.159 6.57-4.027L8 9.586l1.239-.757.367.225A4.49 4.49 0 0 0 8 12.5c0 .526.09 1.03.256 1.5H2a2 2 0 0 1-1.808-1.144M16 4.697v4.974A4.5 4.5 0 0 0 12.5 8a4.5 4.5 0 0 0-1.965.45l-.338-.207z"/>
                                <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.354-1.646a.5.5 0 0 1-.722-.016l-1.149-1.25a.5.5 0 1 1 .737-.676l.28.305V11a.5.5 0 0 1 1 0v1.793l.396-.397a.5.5 0 0 1 .708.708z"/>
                              </svg>
                              Request email change
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-2">
                          <div>
                            <div class="text-muted small">Active sessions</div>
                            <h3 class="h5 mb-1">Devices & sessions</h3>
                            <p class="text-muted small mb-0">Devices and sessions show where you’re currently signed in. Logging out of a session invalidates its refresh token.</p>
                          </div>
                          <button class="btn btn-outline-danger d-inline-flex align-items-center gap-2" id="logoutAllBtn" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-slash-circle" viewBox="0 0 16 16">
                              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                              <path d="M11.354 4.646a.5.5 0 0 0-.708 0l-6 6a.5.5 0 0 0 .708.708l6-6a.5.5 0 0 0 0-.708"/>
                            </svg>
                            Log out of all devices
                          </button>
                        </div>
                        <div class="table-responsive">
                          <table class="table table-sm table-hover align-middle" id="sessionsTable">
                            <thead>
                              <tr>
                                <th>Device</th>
                                <th>Issued</th>
                                <th>Location / IP</th>
                                <th>Expires</th>
                                <th class="text-end"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr><td colspan="5" class="text-muted">Loading sessions…</td></tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </section>

                  <section class="account-section" data-section-content="danger">
                    <div class="row g-3 mb-3">
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <h3 class="h5 mb-1 text-danger">Request account disable</h3>
                              <p class="text-muted small mb-0">Temporarily disable your account. We’ll email you a confirmation link. Once confirmed, you’ll be signed out and won’t be able to log in until re-enabled by support.</p>
                            </div>
                            <button class="btn btn-primary d-inline-flex align-items-center gap-2" id="disableAccountBtn" type="button">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-x-fill" viewBox="0 0 16 16">
                                <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"/>
                              </svg>
                              Request account disable
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-lg-6">
                        <div class="card account-card danger-card shadow-sm h-100">
                          <div class="card-body d-flex flex-column gap-2">
                            <div>
                              <h3 class="h5 mb-1 text-danger">Request account deletion</h3>
                              <p class="text-muted small mb-0">Start the deletion process. You’ll receive a confirmation email. After confirmation, support will permanently delete your account and library data.</p>
                            </div>
                            <button class="btn btn-danger d-inline-flex align-items-center gap-2" id="deleteAccountBtn" type="button">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                              </svg>
                              Request account deletion
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card account-card shadow-sm">
                      <div class="card-body">
                        <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
                          <div>
                            <div class="text-muted small">Programmatic access</div>
                            <h3 class="h5 mb-1">API keys</h3>
                            <p class="text-muted small mb-0">API keys allow programmatic access to your library via the API. Keep them secret and rotate regularly. See <a href="https://api.fjnel.co.za/docs" target="_blank" rel="noreferrer">API docs</a>.</p>
                          </div>
                          <button class="btn btn-outline-primary js-create-api-key" id="createApiKeyBtn" type="button">Create API key</button>
                        </div>
                        <div class="empty-state d-none" id="apiKeysEmpty">
                          <div class="fw-semibold mb-1">No API keys yet</div>
                          <p class="text-muted small mb-3">Create an API key to integrate The Book Project with other tools or scripts. You can revoke keys anytime.</p>
                          <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary btn-sm js-create-api-key" type="button" data-create-api-key>Create API key</button>
                            <a class="btn btn-link btn-sm" href="https://api.fjnel.co.za/docs" target="_blank" rel="noreferrer">Read API docs</a>
                          </div>
                        </div>
                        <div class="table-responsive">
                          <table class="table table-sm table-hover align-middle" id="apiKeysTable">
                            <thead>
                              <tr>
                                <th>Name</th>
                                <th>Prefix</th>
                                <th>Created</th>
                                <th>Expires</th>
                                <th>Last used</th>
                                <th>Status</th>
                                <th class="text-end"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr><td colspan="7" class="text-muted">Loading API keys…</td></tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </section>
        </div>
      </div>
    </div>
  </main>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger d-none" id="editProfileError"></div>
          <div class="mb-3">
            <label class="form-label" for="editFullName">Full name</label>
            <input class="form-control" id="editFullName" type="text" maxlength="255" />
            <small class="form-text text-muted" id="editFullNameHelp"></small>
          </div>
          <div class="mb-0">
            <label class="form-label" for="editPreferredName">Preferred name</label>
            <input class="form-control" id="editPreferredName" type="text" maxlength="100" />
            <small class="form-text text-muted" id="editPreferredNameHelp"></small>
            <div class="form-text text-muted mt-2" id="editProfileChanges">No changes yet.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" id="editProfileResetBtn">Revert</button>
          <button class="btn btn-primary" type="button" id="editProfileSaveBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Change password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger d-none" id="changePasswordError"></div>
          <div class="mb-3">
            <label class="form-label" for="currentPassword">Current password</label>
            <input class="form-control" id="currentPassword" type="password" autocomplete="current-password" />
          </div>
          <div class="mb-3">
            <label class="form-label" for="newPassword">New password</label>
            <input class="form-control" id="newPassword" type="password" autocomplete="new-password" />
          </div>
          <div class="mb-0">
            <label class="form-label" for="confirmNewPassword">Confirm new password</label>
            <input class="form-control" id="confirmNewPassword" type="password" autocomplete="new-password" />
            <small class="form-text text-muted" id="changePasswordHelp">Minimum 10 characters; must differ from current password.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="button" id="changePasswordSaveBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Update password</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Email Modal -->
  <div class="modal fade" id="changeEmailModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request email change</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-success d-none" id="changeEmailSuccess">If this email can be used, you will receive a confirmation link shortly.</div>
          <div class="alert alert-danger d-none" id="changeEmailError"></div>
          <div class="mb-0">
            <label class="form-label" for="newEmail">New email address</label>
            <input class="form-control" id="newEmail" type="email" autocomplete="email" />
            <small class="form-text text-muted">We will send a confirmation email to the new address. This may sign you out of all devices once confirmed.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="button" id="changeEmailSaveBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send request</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Revoke Session Modal -->
  <div class="modal fade" id="revokeSessionModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log out of this device</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">You will be logged out on this device. You can log back in anytime.</p>
          <div class="text-muted small" id="revokeSessionDetail"></div>
          <div class="alert alert-danger d-none mt-3" id="revokeSessionError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmRevokeSessionBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Log out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Out All Modal -->
  <div class="modal fade" id="logoutAllModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log out of all devices</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">This signs you out everywhere. Active refresh tokens will be invalidated.</p>
          <div class="alert alert-danger d-none" id="logoutAllError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmLogoutAllBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Log out everywhere</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create API Key Modal -->
  <div class="modal fade" id="createApiKeyModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create API key</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-success d-none" id="apiKeySecretWrap">
            <div class="fw-semibold mb-1">Copy this secret now</div>
            <div class="api-secret-box mb-2" id="apiKeySecret"></div>
            <button class="btn btn-outline-primary btn-sm" type="button" id="copyApiKeySecretBtn">Copy secret</button>
            <div class="text-muted small mt-2">You will not be able to view this secret again.</div>
          </div>
          <div class="alert alert-danger d-none" id="createApiKeyError"></div>
          <div class="mb-3">
            <label class="form-label" for="apiKeyName">Name</label>
            <input class="form-control" id="apiKeyName" type="text" maxlength="120" />
            <small class="form-text text-muted">Provide a name to identify this key.</small>
          </div>
          <div class="mb-0">
            <label class="form-label" for="apiKeyExpiresAt">Expires at (optional)</label>
            <input class="form-control" id="apiKeyExpiresAt" type="datetime-local" />
            <small class="form-text text-muted">Leave blank for no expiry.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" type="button" id="createApiKeySaveBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Revoke API Key Modal -->
  <div class="modal fade" id="revokeApiKeyModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Revoke API key</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">Revoke this API key? This cannot be undone.</p>
          <div class="text-muted small" id="revokeApiKeyDetail"></div>
          <div class="alert alert-danger d-none mt-3" id="revokeApiKeyError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmRevokeApiKeyBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Revoke</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Disable Account Modal -->
  <div class="modal fade" id="disableAccountModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Disable account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">We will email you a confirmation link. After you confirm, you will be signed out and the account will stay disabled until support re-enables it.</p>
          <div class="alert alert-danger d-none" id="disableAccountError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-warning" type="button" id="confirmDisableAccountBtn"><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send email</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request account deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">We will email you a confirmation link. After you confirm, support will permanently delete your account and library data.</p>
          <p class="text-muted small mb-3">Type <strong>DELETE</strong> to continue.</p>
          <input class="form-control mb-2" id="deleteAccountConfirmInput" type="text" autocomplete="off" placeholder="Type DELETE to confirm" />
          <div class="alert alert-danger d-none" id="deleteAccountError"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" type="button" id="confirmDeleteAccountBtn" disabled><span class="spinner-border spinner-border-sm d-none" role="status"></span> Send request</button>
        </div>
      </div>
    </div>
  </div>

  <div id="recaptcha-root" class="hidden" data-sitekey="6LeedsorAAAAALv_xUltcVyeYvCInfhGVl7qkeMA"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/http-interceptor.js"></script>
  <script src="assets/js/common.js"></script>
  <script src="assets/js/maintenance.js"></script>
  <script src="assets/js/recaptcha-v3.js"></script>
  <script src="assets/js/account.js"></script>
</body>
</html>
